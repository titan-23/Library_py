<!DOCTYPE html>

<html class="no-js" data-content_root="../" lang="en">
<head><meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="light dark" name="color-scheme"/><meta content="width=device-width, initial-scale=1" name="viewport">
<link href="../genindex.html" rel="index" title="Index"/><link href="../search.html" rel="search" title="Search"/><link href="titan_pylib.data_structures.wavelet_matrix.fenwick_tree_wavelet_matrix.html" rel="next" title="titan_pylib.data_structures.wavelet_matrix.fenwick_tree_wavelet_matrix"/><link href="titan_pylib.data_structures.wavelet_matrix.cumulative_sum_wavelet_matrix.html" rel="prev" title="titan_pylib.data_structures.wavelet_matrix.cumulative_sum_wavelet_matrix"/>
<!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
<title>dynamic_wavelet_matrix - titan_pylib documentation</title>
<link href="../_static/pygments.css?v=8f2a1f02" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/furo.css?v=354aac6f" rel="stylesheet" type="text/css"/>
<link href="../_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="../_static/styles/furo-extensions.css?v=302659d7" rel="stylesheet" type="text/css"/>
<link href="../_static/_static/style.css" rel="stylesheet" type="text/css"/>
<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></meta></head>
<body>
<script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
<svg style="display: none;" xmlns="http://www.w3.org/2000/svg">
<symbol id="svg-toc" viewbox="0 0 24 24">
<title>Contents</title>
<svg fill="currentColor" stroke="currentColor" stroke-width="0" viewbox="0 0 1024 1024">
<path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"></path>
</svg>
</symbol>
<symbol id="svg-menu" viewbox="0 0 24 24">
<title>Menu</title>
<svg class="feather-menu" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<line x1="3" x2="21" y1="12" y2="12"></line>
<line x1="3" x2="21" y1="6" y2="6"></line>
<line x1="3" x2="21" y1="18" y2="18"></line>
</svg>
</symbol>
<symbol id="svg-arrow-right" viewbox="0 0 24 24">
<title>Expand</title>
<svg class="feather-chevron-right" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</symbol>
<symbol id="svg-sun" viewbox="0 0 24 24">
<title>Light mode</title>
<svg class="feather-sun" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<circle cx="12" cy="12" r="5"></circle>
<line x1="12" x2="12" y1="1" y2="3"></line>
<line x1="12" x2="12" y1="21" y2="23"></line>
<line x1="4.22" x2="5.64" y1="4.22" y2="5.64"></line>
<line x1="18.36" x2="19.78" y1="18.36" y2="19.78"></line>
<line x1="1" x2="3" y1="12" y2="12"></line>
<line x1="21" x2="23" y1="12" y2="12"></line>
<line x1="4.22" x2="5.64" y1="19.78" y2="18.36"></line>
<line x1="18.36" x2="19.78" y1="5.64" y2="4.22"></line>
</svg>
</symbol>
<symbol id="svg-moon" viewbox="0 0 24 24">
<title>Dark mode</title>
<svg class="icon-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path>
</svg>
</symbol>
<symbol id="svg-sun-with-moon" viewbox="0 0 24 24">
<title>Auto light/dark, in light mode</title>
<svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z" style="opacity: 50%"></path>
<line x1="14.5" x2="14.5" y1="3.25" y2="1.25"></line>
<line x1="14.5" x2="14.5" y1="15.85" y2="17.85"></line>
<line x1="10.044" x2="8.63" y1="5.094" y2="3.68"></line>
<line x1="19" x2="20.414" y1="14.05" y2="15.464"></line>
<line x1="8.2" x2="6.2" y1="9.55" y2="9.55"></line>
<line x1="20.8" x2="22.8" y1="9.55" y2="9.55"></line>
<line x1="10.044" x2="8.63" y1="14.006" y2="15.42"></line>
<line x1="19" x2="20.414" y1="5.05" y2="3.636"></line>
<circle cx="14.5" cy="9.55" r="3.6"></circle>
</svg>
</symbol>
<symbol id="svg-moon-with-sun" viewbox="0 0 24 24">
<title>Auto light/dark, in dark mode</title>
<svg class="icon-custom-derived-from-feather-sun-and-tabler-moon" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"></path>
<line style="opacity: 50%" x1="18" x2="18" y1="3.705" y2="2.5"></line>
<line style="opacity: 50%" x1="18" x2="18" y1="11.295" y2="12.5"></line>
<line style="opacity: 50%" x1="15.316" x2="14.464" y1="4.816" y2="3.964"></line>
<line style="opacity: 50%" x1="20.711" x2="21.563" y1="10.212" y2="11.063"></line>
<line style="opacity: 50%" x1="14.205" x2="13.001" y1="7.5" y2="7.5"></line>
<line style="opacity: 50%" x1="21.795" x2="23" y1="7.5" y2="7.5"></line>
<line style="opacity: 50%" x1="15.316" x2="14.464" y1="10.184" y2="11.036"></line>
<line style="opacity: 50%" x1="20.711" x2="21.563" y1="4.789" y2="3.937"></line>
<circle cx="18" cy="7.5" r="2.169" style="opacity: 50%"></circle>
</svg>
</symbol>
<symbol id="svg-pencil" viewbox="0 0 24 24">
<svg class="icon-tabler-pencil-code" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4"></path>
<path d="M13.5 6.5l4 4"></path>
<path d="M20 21l2 -2l-2 -2"></path>
<path d="M17 17l-2 2l2 2"></path>
</svg>
</symbol>
<symbol id="svg-eye" viewbox="0 0 24 24">
<svg class="icon-tabler-eye-code" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0h24v24H0z" fill="none" stroke="none"></path>
<path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0"></path>
<path d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008"></path>
<path d="M20 21l2 -2l-2 -2"></path>
<path d="M17 17l-2 2l2 2"></path>
</svg>
</symbol>
</svg>
<input class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<input class="sidebar-toggle" id="__toc" name="__toc" type="checkbox"/>
<label class="overlay sidebar-overlay" for="__navigation">
<div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
<div class="visually-hidden">Hide table of contents sidebar</div>
</label>
<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>
<div class="page">
<header class="mobile-header">
<div class="header-left">
<label class="nav-overlay-icon" for="__navigation">
<div class="visually-hidden">Toggle site navigation sidebar</div>
<i class="icon"><svg><use href="#svg-menu"></use></svg></i>
</label>
</div>
<div class="header-center">
<a href="../index.html"><div class="brand">titan_pylib  documentation</div></a>
</div>
<div class="header-right">
<div class="theme-toggle-container theme-toggle-header">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
<svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-header-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
</header>
<aside class="sidebar-drawer">
<div class="sidebar-container">
<div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
<span class="sidebar-brand-text">titan_pylib  documentation</span>
</a><form action="../search.html" class="sidebar-search-container" method="get" role="search">
<input aria-label="Search" class="sidebar-search" name="q" placeholder="Search"/>
<input name="check_keywords" type="hidden" value="yes"/>
<input name="area" type="hidden" value="default"/>
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.ahc.html">ahc</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of titan_pylib.ahc</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.ahc.ahc_settings.html">ahc_settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.ahc.calc_ratio.html">calc_ratio</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.ahc.optimizer.html">optimizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.ahc.parallel_tester.html">parallel_tester</a></li>
</ul>
</input></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.algorithm.html">algorithm</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of titan_pylib.algorithm</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.algorithm.random.html">random</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of titan_pylib.algorithm.random</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.random.random.html">random</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.random.random_graph.html">random_graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.random.random_tree.html">random_tree</a></li>
</ul>
</input></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.algorithm.sort.html">sort</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of titan_pylib.algorithm.sort</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.sort.bubble_sort.html">bubble_sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.sort.merge_sort.html">merge_sort</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.algorithm.sort.quick_sort.html">quick_sort</a></li>
</ul>
</input></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.arithmetic_progression.html">arithmetic_progression</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.cycle_memo.html">cycle_memo</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.doubling.html">doubling</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.gray_code.html">gray_code</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.mo.html">mo</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.parser.html">parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.algorithm.permutation.html">permutation</a></li>
</ul>
</input></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="titan_pylib.data_structures.html">data_structures</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.array.html">array</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.array</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.array.array_2D.html">array_2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.array.csr_array.html">csr_array</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.array.partial_persistent_array.html">partial_persistent_array</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.array.persistent_array.html">persistent_array</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.html">avl_tree</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.avl_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_dict.html">avl_tree_dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_multiset.html">avl_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_multiset2.html">avl_tree_multiset2</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_multiset3.html">avl_tree_multiset3</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_set.html">avl_tree_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_set2.html">avl_tree_set2</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.avl_tree_set3.html">avl_tree_set3</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.lazy_avl_tree.html">lazy_avl_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.persistent_avl_tree_list.html">persistent_avl_tree_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.persistent_lazy_avl_tree.html">persistent_lazy_avl_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.reversible_lazy_avl_tree.html">reversible_lazy_avl_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.avl_tree.wbt_set.html">wbt_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.b_tree.html">b_tree</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.b_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.b_tree.b_tree_list.html">b_tree_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.b_tree.b_tree_set.html">b_tree_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.binary_trie.html">binary_trie</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.binary_trie</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.binary_trie.binary_trie_multiset.html">binary_trie_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.binary_trie.binary_trie_set.html">binary_trie_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.bit_vector.html">bit_vector</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.bit_vector</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bit_vector.avl_tree_bit_vector.html">avl_tree_bit_vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bit_vector.bit_vector.html">bit_vector</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bit_vector.bit_vector_interface.html">bit_vector_interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bit_vector.splay_tree_bit_vector.html">splay_tree_bit_vector</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.bst_base.html">bst_base</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.bst_base</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bst_base.bst_multiset_array_base.html">bst_multiset_array_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bst_base.bst_multiset_node_base.html">bst_multiset_node_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.bst_base.bst_set_node_base.html">bst_set_node_base</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.cumulative_sum.html">cumulative_sum</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.cumulative_sum</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.cumulative_sum.cumulative_op.html">cumulative_op</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.cumulative_sum.cumulative_sum.html">cumulative_sum</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.cumulative_sum.cumulative_sum2D.html">cumulative_sum2D</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.deque.html">deque</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.deque</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.deque.deque.html">deque</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.deque.foldable_deque.html">foldable_deque</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.dict.html">dict</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.dict</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.dict.hash_dict.html">hash_dict</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.dynamic_connectivity.html">dynamic_connectivity</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.dynamic_connectivity</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.dynamic_connectivity.euler_tour_tree.html">euler_tour_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.dynamic_connectivity.lazy_link_cut_tree.html">lazy_link_cut_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.dynamic_connectivity.link_cut_tree.html">link_cut_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.dynamic_connectivity.offline_dynamic_connectivity.html">offline_dynamic_connectivity</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.html">fenwick_tree</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.fenwick_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.dynamic_fenwick_tree.html">dynamic_fenwick_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.dynamic_fenwick_tree_2D.html">dynamic_fenwick_tree_2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.fenwick_tree.html">fenwick_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.fenwick_tree_2D.html">fenwick_tree_2D</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.fenwick_tree_2D_RAQ.html">fenwick_tree_2D_RAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.fenwick_tree_RAQ.html">fenwick_tree_RAQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.fenwick_tree.fenwick_tree_abst.html">fenwick_tree_abst</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.heap.html">heap</a><input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" role="switch" type="checkbox"/><label for="toctree-checkbox-17"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.heap</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.Randomized_meldable_heap.html">Randomized_meldable_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.binomial_heap.html">binomial_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.deletable_max_heap.html">deletable_max_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.deletable_min_heap.html">deletable_min_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.double_ended_heap.html">double_ended_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.max_heap.html">max_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.min_heap.html">min_heap</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.heap.radix_heap.html">radix_heap</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.list.html">list</a><input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" role="switch" type="checkbox"/><label for="toctree-checkbox-18"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.list</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.list.linked_list.html">linked_list</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.merge_sort_tree.html">merge_sort_tree</a><input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" role="switch" type="checkbox"/><label for="toctree-checkbox-19"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.merge_sort_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.merge_sort_tree.merge_sort_tree.html">merge_sort_tree</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.others.html">others</a><input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" role="switch" type="checkbox"/><label for="toctree-checkbox-20"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.others</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.others.pair.html">pair</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.rbst.html">rbst</a><input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" role="switch" type="checkbox"/><label for="toctree-checkbox-21"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.rbst</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.rbst.lazy_rbst.html">lazy_rbst</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.red_black_tree.html">red_black_tree</a><input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" role="switch" type="checkbox"/><label for="toctree-checkbox-22"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.red_black_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.red_black_tree.red_black_tree_multiset.html">red_black_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.red_black_tree.red_black_tree_set.html">red_black_tree_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.safe_hash.html">safe_hash</a><input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" role="switch" type="checkbox"/><label for="toctree-checkbox-23"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.safe_hash</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.safe_hash.hash_counter.html">hash_counter</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.safe_hash.hash_defaultdict.html">hash_defaultdict</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.safe_hash.hash_dict.html">hash_dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.safe_hash.hash_set.html">hash_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.scapegoat_tree.html">scapegoat_tree</a><input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" role="switch" type="checkbox"/><label for="toctree-checkbox-24"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.scapegoat_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.scapegoat_tree.scapegoat_tree_multiset.html">scapegoat_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.scapegoat_tree.scapegoat_tree_set.html">scapegoat_tree_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.segment_quadratic_division.html">segment_quadratic_division</a><input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" role="switch" type="checkbox"/><label for="toctree-checkbox-25"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.segment_quadratic_division</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_quadratic_division.quadratic_division_list.html">quadratic_division_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_quadratic_division.segment_lazy_quadratic_division.html">segment_lazy_quadratic_division</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_quadratic_division.segment_quadratic_division.html">segment_quadratic_division</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.html">segment_tree</a><input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" role="switch" type="checkbox"/><label for="toctree-checkbox-26"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.segment_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.dual_commutative_segment_tree.html">dual_commutative_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.dual_segment_tree.html">dual_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.dual_segment_tree_commutative.html">dual_segment_tree_commutative</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.dynamic_segment_tree.html">dynamic_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.lazy_segment_tree.html">lazy_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.lazy_segment_tree_range.html">lazy_segment_tree_range</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.persistent_segment_tree.html">persistent_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.range_set_range_composite.html">range_set_range_composite</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.segment_tree.html">segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.segment_tree_RSQ.html">segment_tree_RSQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.segment_tree_RmQ.html">segment_tree_RmQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.segment_tree.segment_tree_interface.html">segment_tree_interface</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.set.html">set</a><input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" role="switch" type="checkbox"/><label for="toctree-checkbox-27"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.set</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.dynamic_fenwick_tree_multiset.html">dynamic_fenwick_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.dynamic_fenwick_tree_set.html">dynamic_fenwick_tree_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.fenwick_tree_multiset.html">fenwick_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.fenwick_tree_set.html">fenwick_tree_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.fenwick_tree_set_fast.html">fenwick_tree_set_fast</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.hash_set.html">hash_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.hashed_multiset.html">hashed_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.mex_multiset.html">mex_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.min_max_multiset.html">min_max_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.min_max_set.html">min_max_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.multiset_quadratic_division.html">multiset_quadratic_division</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.range_set.html">range_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.segki_set.html">segki_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.set_quadratic_division.html">set_quadratic_division</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.sorted_multiset.html">sorted_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.sorted_set.html">sorted_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.static_ordered_multiset.html">static_ordered_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.static_ordered_set.html">static_ordered_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.wordsize_tree_multiset.html">wordsize_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.set.wordsize_tree_set.html">wordsize_tree_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.sparse_table.html">sparse_table</a><input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" role="switch" type="checkbox"/><label for="toctree-checkbox-28"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.sparse_table</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.sparse_table.sparse_table.html">sparse_table</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.sparse_table.sparse_table_RmQ.html">sparse_table_RmQ</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.html">splay_tree</a><input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" role="switch" type="checkbox"/><label for="toctree-checkbox-29"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.splay_tree</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.lazy_splay_tree.html">lazy_splay_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.lazy_splay_tree_array.html">lazy_splay_tree_array</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.reversible_lazy_splay_tree_array.html">reversible_lazy_splay_tree_array</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_dict.html">splay_tree_dict</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_list.html">splay_tree_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_list_array.html">splay_tree_list_array</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_multiset.html">splay_tree_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_multiset2.html">splay_tree_multiset2</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_multiset_sum.html">splay_tree_multiset_sum</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_multiset_top_down.html">splay_tree_multiset_top_down</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_set.html">splay_tree_set</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.splay_tree.splay_tree_set_top_down.html">splay_tree_set_top_down</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.stack.html">stack</a><input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" role="switch" type="checkbox"/><label for="toctree-checkbox-30"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.stack</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.stack.foldable_stack.html">foldable_stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.stack.persistent_stack.html">persistent_stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.stack.stack.html">stack</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.static_array_query.html">static_array_query</a><input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" role="switch" type="checkbox"/><label for="toctree-checkbox-31"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.static_array_query</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.static_array_query.static_RmQ.html">static_RmQ</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.static_array_query.static_range_mode_query.html">static_range_mode_query</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.treap.html">treap</a><input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" role="switch" type="checkbox"/><label for="toctree-checkbox-32"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.treap</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.treap.treap_multiset.html">treap_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.treap.treap_set.html">treap_set</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.union_find.html">union_find</a><input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" role="switch" type="checkbox"/><label for="toctree-checkbox-33"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.union_find</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.fully_retroactive_union_find.html">fully_retroactive_union_find</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.partial_persistent_union_find.html">partial_persistent_union_find</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.persistent_union_find.html">persistent_union_find</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.undoable_union_find.html">undoable_union_find</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.union_find.html">union_find</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.union_find_heavy.html">union_find_heavy</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.union_find_members.html">union_find_members</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.union_find.weighted_union_find.html">weighted_union_find</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="titan_pylib.data_structures.wavelet_matrix.html">wavelet_matrix</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" role="switch" type="checkbox"/><label for="toctree-checkbox-34"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.wavelet_matrix</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wavelet_matrix.cumulative_sum_wavelet_matrix.html">cumulative_sum_wavelet_matrix</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">dynamic_wavelet_matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wavelet_matrix.fenwick_tree_wavelet_matrix.html">fenwick_tree_wavelet_matrix</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wavelet_matrix.wavelet_matrix.html">wavelet_matrix</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.data_structures.wbt.html">wbt</a><input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" role="switch" type="checkbox"/><label for="toctree-checkbox-35"><div class="visually-hidden">Toggle navigation of titan_pylib.data_structures.wbt</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wbt.wbt_lazy_list.html">wbt_lazy_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wbt.wbt_list.html">wbt_list</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wbt.wbt_multiset.html">wbt_multiset</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.data_structures.wbt.wbt_set.html">wbt_set</a></li>
</ul>
</li>
</ul>
</input></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.geometry.html">geometry</a><input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" role="switch" type="checkbox"/><label for="toctree-checkbox-36"><div class="visually-hidden">Toggle navigation of titan_pylib.geometry</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.geometry.geometry.html">geometry</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.graph.html">graph</a><input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" role="switch" type="checkbox"/><label for="toctree-checkbox-37"><div class="visually-hidden">Toggle navigation of titan_pylib.graph</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.graph.flow.html">flow</a><input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" role="switch" type="checkbox"/><label for="toctree-checkbox-38"><div class="visually-hidden">Toggle navigation of titan_pylib.graph.flow</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.flow.bipartite_max_matching.html">bipartite_max_matching</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.flow.max_flow_dinic.html">max_flow_dinic</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.flow.max_flow_ford_fulkerson.html">max_flow_ford_fulkerson</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="titan_pylib.graph.hld.html">hld</a><input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" role="switch" type="checkbox"/><label for="toctree-checkbox-39"><div class="visually-hidden">Toggle navigation of titan_pylib.graph.hld</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.hld.hld.html">hld</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.hld.hld_lazy_segment_tree.html">hld_lazy_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.hld.hld_noncommutative_segment_tree.html">hld_noncommutative_segment_tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="titan_pylib.graph.hld.hld_segment_tree.html">hld_segment_tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.bellman_ford.html">bellman_ford</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.bfs.html">bfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.cartesian_tree.html">cartesian_tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.dfs_tree.html">dfs_tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.dijkstra.html">dijkstra</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.euler_tour.html">euler_tour</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.functional_graph.html">functional_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_articulation_points.html">get_articulation_points</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_biconnected_components.html">get_biconnected_components</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_bridge.html">get_bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_scc.html">get_scc</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_scc_graph.html">get_scc_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.get_scc_lowlink.html">get_scc_lowlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.grid_bfs.html">grid_bfs</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.is_bipartite_graph.html">is_bipartite_graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.lca.html">lca</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.namori.html">namori</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.perfect_binary_tree.html">perfect_binary_tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.rerooting_dp.html">rerooting_dp</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.rooted_tree.html">rooted_tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.spfa.html">spfa</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.topological_sort.html">topological_sort</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.warshall_floyd.html">warshall_floyd</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.graph.weighted_rooted_tree.html">weighted_rooted_tree</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.io.html">io</a><input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" role="switch" type="checkbox"/><label for="toctree-checkbox-40"><div class="visually-hidden">Toggle navigation of titan_pylib.io</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.io.fast_o.html">fast_o</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.math.html">math</a><input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" role="switch" type="checkbox"/><label for="toctree-checkbox-41"><div class="visually-hidden">Toggle navigation of titan_pylib.math</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.affine_map.html">affine_map</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.big_int.html">big_int</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.comb.html">comb</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.decimal_util.html">decimal_util</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.divisors.html">divisors</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.fraction.html">fraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.get_quotients.html">get_quotients</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.is_prime64.html">is_prime64</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_array.html">mod_array</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_comb.html">mod_comb</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_int.html">mod_int</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_int_1000000007.html">mod_int_1000000007</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_int_998244353.html">mod_int_998244353</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.mod_matrix.html">mod_matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.number.html">number</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.math.pollard_rho.html">pollard_rho</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="titan_pylib.string.html">string</a><input class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" role="switch" type="checkbox"/><label for="toctree-checkbox-42"><div class="visually-hidden">Toggle navigation of titan_pylib.string</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.dynamic_hash_string.html">dynamic_hash_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.get_suffix_array.html">get_suffix_array</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.hash_string.html">hash_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.multi_hash_string.html">multi_hash_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.string_count.html">string_count</a></li>
<li class="toctree-l2"><a class="reference internal" href="titan_pylib.string.trie.html">trie</a></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
</aside>
<div class="main">
<div class="content">
<div class="article-container">
<a class="back-to-top muted-link" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
</svg>
<span>Back to top</span>
</a>
<div class="content-icon-container">
<div class="view-this-page">
<a class="muted-link" href="../_sources/titan_pylib_docs/titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.rst.txt" title="View this page">
<svg><use href="#svg-eye"></use></svg>
<span class="visually-hidden">View this page</span>
</a>
</div>
<div class="theme-toggle-container theme-toggle-content">
<button class="theme-toggle">
<div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
<svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
<svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
<svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
<svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
</button>
</div>
<label class="toc-overlay-icon toc-content-icon" for="__toc">
<div class="visually-hidden">Toggle table of contents sidebar</div>
<i class="icon"><svg><use href="#svg-toc"></use></svg></i>
</label>
</div>
<article id="furo-main-content" role="main">
<section id="titan-pylib-data-structures-wavelet-matrix-dynamic-wavelet-matrix">
<h1>dynamic_wavelet_matrix<a class="headerlink" href="#titan-pylib-data-structures-wavelet-matrix-dynamic-wavelet-matrix" title="Link to this heading">¶</a></h1>
<section id="id1">
<h2>ソースコード<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix</span><span class="w"> </span><span class="kn">import</span> <span class="n">DynamicWaveletMatrix</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/titan-23/Library_py/tree/main/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.py">view on github</a></p>
<section id="id2">
<h3>展開済みコード<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">   1</span><span class="c1"># from titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix import DynamicWaveletMatrix</span>
<span class="linenos">   2</span><span class="c1"># from titan_pylib.data_structures.bit_vector.avl_tree_bit_vector import AVLTreeBitVector</span>
<span class="linenos">   3</span><span class="c1"># from titan_pylib.data_structures.bit_vector.bit_vector_interface import (</span>
<span class="linenos">   4</span><span class="c1">#     BitVectorInterface,</span>
<span class="linenos">   5</span><span class="c1"># )</span>
<span class="linenos">   6</span><span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="linenos">   7</span>
<span class="linenos">   8</span>
<span class="linenos">   9</span><span class="k">class</span><span class="w"> </span><span class="nc">BitVectorInterface</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="linenos">  10</span>
<span class="linenos">  11</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  12</span>    <span class="k">def</span><span class="w"> </span><span class="nf">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  13</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  14</span>
<span class="linenos">  15</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  16</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  17</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  18</span>
<span class="linenos">  19</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  20</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  21</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  22</span>
<span class="linenos">  23</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  24</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  25</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  26</span>
<span class="linenos">  27</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  28</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  29</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  30</span>
<span class="linenos">  31</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  32</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  33</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  34</span>
<span class="linenos">  35</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  36</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  37</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  38</span>
<span class="linenos">  39</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  40</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  41</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  42</span>
<span class="linenos">  43</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  44</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  45</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  46</span>
<span class="linenos">  47</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  48</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos">  49</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  50</span>
<span class="linenos">  51</span>    <span class="nd">@abstractmethod</span>
<span class="linenos">  52</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos">  53</span>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<span class="linenos">  54</span><span class="kn">from</span><span class="w"> </span><span class="nn">array</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="linenos">  55</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Final</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="linenos">  56</span>
<span class="linenos">  57</span><span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span> <span class="n">Final</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">31</span>
<span class="linenos">  58</span>
<span class="linenos">  59</span>
<span class="linenos">  60</span><span class="k">class</span><span class="w"> </span><span class="nc">AVLTreeBitVector</span><span class="p">(</span><span class="n">BitVectorInterface</span><span class="p">):</span>
<span class="linenos">  61</span><span class="w">    </span><span class="sd">"""AVL木で書かれたビットベクトルです。簡潔でもなんでもありません。</span>
<span class="linenos">  62</span>
<span class="linenos">  63</span><span class="sd">    bit列を管理するわけですが、各節点は 1~32 bit を持つようにしています。</span>
<span class="linenos">  64</span><span class="sd">    これにより、最大 32 倍高速化が行えます。(16~32bitとするといいんだろうけど)</span>
<span class="linenos">  65</span><span class="sd">    """</span>
<span class="linenos">  66</span>
<span class="linenos">  67</span>    <span class="nd">@staticmethod</span>
<span class="linenos">  68</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_popcount</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">  69</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x55555555</span><span class="p">)</span>
<span class="linenos">  70</span>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span>
<span class="linenos">  71</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F0F0F0F</span>
<span class="linenos">  72</span>        <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
<span class="linenos">  73</span>        <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
<span class="linenos">  74</span>        <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x0000007F</span>
<span class="linenos">  75</span>
<span class="linenos">  76</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]):</span>
<span class="linenos">  77</span><span class="w">        </span><span class="sd">"""</span>
<span class="linenos">  78</span><span class="sd">        :math:`O(n)` です。</span>
<span class="linenos">  79</span>
<span class="linenos">  80</span><span class="sd">        Args:</span>
<span class="linenos">  81</span><span class="sd">          a (Iterable[int], optional): 構築元の配列です。</span>
<span class="linenos">  82</span><span class="sd">        """</span>
<span class="linenos">  83</span>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">  84</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="linenos">  85</span>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">  86</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">  87</span>        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">  88</span>        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">  89</span>        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="linenos">  90</span>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="linenos">  91</span>        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">  92</span>        <span class="k">if</span> <span class="n">a</span><span class="p">:</span>
<span class="linenos">  93</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">  94</span>
<span class="linenos">  95</span>    <span class="k">def</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">  96</span><span class="w">        </span><span class="sd">"""``n`` 要素分のメモリを確保します。</span>
<span class="linenos">  97</span><span class="sd">        :math:`O(n)` です。</span>
<span class="linenos">  98</span><span class="sd">        """</span>
<span class="linenos">  99</span>        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos"> 100</span>        <span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">))</span>
<span class="linenos"> 101</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span> <span class="o">+=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="linenos"> 102</span>        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos"> 103</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos"> 104</span>        <span class="bp">self</span><span class="o">.</span><span class="n">total</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos"> 105</span>        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos"> 106</span>        <span class="bp">self</span><span class="o">.</span><span class="n">right</span> <span class="o">+=</span> <span class="n">a</span>
<span class="linenos"> 107</span>        <span class="bp">self</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="linenos"> 108</span>
<span class="linenos"> 109</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 110</span>        <span class="n">key</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 111</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 112</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 113</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 114</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 115</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 116</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 117</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 118</span>        <span class="p">)</span>
<span class="linenos"> 119</span>        <span class="n">_popcount</span> <span class="o">=</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span>
<span class="linenos"> 120</span>
<span class="linenos"> 121</span>        <span class="k">def</span><span class="w"> </span><span class="nf">rec</span><span class="p">(</span><span class="n">lr</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 122</span>            <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">lr</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span><span class="p">,</span> <span class="n">lr</span> <span class="o">&amp;</span> <span class="n">msk</span>
<span class="linenos"> 123</span>            <span class="n">mid</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 124</span>            <span class="n">hl</span><span class="p">,</span> <span class="n">hr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="linenos"> 125</span>            <span class="k">if</span> <span class="n">l</span> <span class="o">!=</span> <span class="n">mid</span><span class="p">:</span>
<span class="linenos"> 126</span>                <span class="n">le</span> <span class="o">=</span> <span class="n">rec</span><span class="p">(</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span> <span class="o">|</span> <span class="n">mid</span><span class="p">)</span>
<span class="linenos"> 127</span>                <span class="n">left</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">hl</span> <span class="o">=</span> <span class="n">le</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span><span class="p">,</span> <span class="n">le</span> <span class="o">&amp;</span> <span class="n">msk</span>
<span class="linenos"> 128</span>                <span class="n">size</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">mid</span><span class="p">]]</span>
<span class="linenos"> 129</span>                <span class="n">total</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">mid</span><span class="p">]]</span>
<span class="linenos"> 130</span>            <span class="k">if</span> <span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="n">r</span><span class="p">:</span>
<span class="linenos"> 131</span>                <span class="n">ri</span> <span class="o">=</span> <span class="n">rec</span><span class="p">((</span><span class="n">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span> <span class="o">|</span> <span class="n">r</span><span class="p">)</span>
<span class="linenos"> 132</span>                <span class="n">right</span><span class="p">[</span><span class="n">mid</span><span class="p">],</span> <span class="n">hr</span> <span class="o">=</span> <span class="n">ri</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span><span class="p">,</span> <span class="n">ri</span> <span class="o">&amp;</span> <span class="n">msk</span>
<span class="linenos"> 133</span>                <span class="n">size</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">size</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">mid</span><span class="p">]]</span>
<span class="linenos"> 134</span>                <span class="n">total</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">mid</span><span class="p">]]</span>
<span class="linenos"> 135</span>            <span class="n">balance</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span> <span class="o">=</span> <span class="n">hl</span> <span class="o">-</span> <span class="n">hr</span>
<span class="linenos"> 136</span>            <span class="k">return</span> <span class="n">mid</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span> <span class="o">|</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">hl</span><span class="p">,</span> <span class="n">hr</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 137</span>
<span class="linenos"> 138</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
<span class="linenos"> 139</span>            <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos"> 140</span>        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos"> 141</span>        <span class="n">bit</span> <span class="o">=</span> <span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span>
<span class="linenos"> 142</span>        <span class="n">msk</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="linenos"> 143</span>        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
<span class="linenos"> 144</span>        <span class="bp">self</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos"> 145</span>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 146</span>        <span class="n">indx</span> <span class="o">=</span> <span class="n">end</span>
<span class="linenos"> 147</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">):</span>
<span class="linenos"> 148</span>            <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 149</span>            <span class="n">v</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 150</span>            <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
<span class="linenos"> 151</span>                <span class="n">v</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 152</span>                <span class="n">v</span> <span class="o">|=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span>
<span class="linenos"> 153</span>                <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 154</span>            <span class="n">key</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
<span class="linenos"> 155</span>            <span class="n">bit_len</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
<span class="linenos"> 156</span>            <span class="n">size</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>
<span class="linenos"> 157</span>            <span class="n">total</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">_popcount</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="linenos"> 158</span>            <span class="n">indx</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 159</span>        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">indx</span>
<span class="linenos"> 160</span>        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">rec</span><span class="p">(</span><span class="n">end</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span>
<span class="linenos"> 161</span>
<span class="linenos"> 162</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_rotate_L</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 163</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 164</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 165</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 166</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 167</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 168</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 169</span>        <span class="p">)</span>
<span class="linenos"> 170</span>        <span class="n">u</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 171</span>        <span class="n">size</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 172</span>        <span class="n">total</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 173</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
<span class="linenos"> 174</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
<span class="linenos"> 175</span>        <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
<span class="linenos"> 176</span>        <span class="n">right</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
<span class="linenos"> 177</span>        <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 178</span>            <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 179</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 180</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 181</span>            <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 182</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 183</span>        <span class="k">return</span> <span class="n">u</span>
<span class="linenos"> 184</span>
<span class="linenos"> 185</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_rotate_R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 186</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 187</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 188</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 189</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 190</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 191</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 192</span>        <span class="p">)</span>
<span class="linenos"> 193</span>        <span class="n">u</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 194</span>        <span class="n">size</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 195</span>        <span class="n">total</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 196</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
<span class="linenos"> 197</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">u</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">u</span><span class="p">])</span>
<span class="linenos"> 198</span>        <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">u</span><span class="p">]</span>
<span class="linenos"> 199</span>        <span class="n">left</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
<span class="linenos"> 200</span>        <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 201</span>            <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 202</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 203</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 204</span>            <span class="n">balance</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 205</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 206</span>        <span class="k">return</span> <span class="n">u</span>
<span class="linenos"> 207</span>
<span class="linenos"> 208</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 209</span>        <span class="n">balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balance</span>
<span class="linenos"> 210</span>        <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 211</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 212</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 213</span>        <span class="k">elif</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 214</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 215</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos"> 216</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 217</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 218</span>            <span class="n">balance</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 219</span>        <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 220</span>
<span class="linenos"> 221</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_rotate_LR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 222</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
<span class="linenos"> 223</span>        <span class="n">B</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 224</span>        <span class="n">E</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">B</span><span class="p">]</span>
<span class="linenos"> 225</span>        <span class="n">size</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 226</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">-</span> <span class="n">size</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]]</span>
<span class="linenos"> 227</span>        <span class="n">size</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">[</span><span class="n">E</span><span class="p">]</span>
<span class="linenos"> 228</span>        <span class="n">total</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 229</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">-</span> <span class="n">total</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]]</span>
<span class="linenos"> 230</span>        <span class="n">total</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">E</span><span class="p">])</span>
<span class="linenos"> 231</span>        <span class="n">right</span><span class="p">[</span><span class="n">B</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">E</span><span class="p">]</span>
<span class="linenos"> 232</span>        <span class="n">left</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">B</span>
<span class="linenos"> 233</span>        <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]</span>
<span class="linenos"> 234</span>        <span class="n">right</span><span class="p">[</span><span class="n">E</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
<span class="linenos"> 235</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_balance</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
<span class="linenos"> 236</span>        <span class="k">return</span> <span class="n">E</span>
<span class="linenos"> 237</span>
<span class="linenos"> 238</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_rotate_RL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 239</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
<span class="linenos"> 240</span>        <span class="n">C</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 241</span>        <span class="n">D</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">C</span><span class="p">]</span>
<span class="linenos"> 242</span>        <span class="n">size</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 243</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]]</span>
<span class="linenos"> 244</span>        <span class="n">size</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>
<span class="linenos"> 245</span>        <span class="n">total</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 246</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]]</span>
<span class="linenos"> 247</span>        <span class="n">total</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">-=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">D</span><span class="p">])</span>
<span class="linenos"> 248</span>        <span class="n">left</span><span class="p">[</span><span class="n">C</span><span class="p">]</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>
<span class="linenos"> 249</span>        <span class="n">right</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span>
<span class="linenos"> 250</span>        <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]</span>
<span class="linenos"> 251</span>        <span class="n">left</span><span class="p">[</span><span class="n">D</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
<span class="linenos"> 252</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_balance</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
<span class="linenos"> 253</span>        <span class="k">return</span> <span class="n">D</span>
<span class="linenos"> 254</span>
<span class="linenos"> 255</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 256</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 257</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 258</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 259</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 260</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 261</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 262</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 263</span>        <span class="p">)</span>
<span class="linenos"> 264</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 265</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 266</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 267</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 268</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 269</span>                <span class="n">r</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 270</span>                <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span>
<span class="linenos"> 271</span>                    <span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
<span class="linenos"> 272</span>                <span class="p">)</span>
<span class="linenos"> 273</span>                <span class="k">break</span>
<span class="linenos"> 274</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">r</span><span class="p">:</span>
<span class="linenos"> 275</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 276</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 277</span>                <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 278</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 279</span>                <span class="n">r</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 280</span>        <span class="k">return</span> <span class="n">s</span>
<span class="linenos"> 281</span>
<span class="linenos"> 282</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_make_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 283</span>        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span>
<span class="linenos"> 284</span>        <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">):</span>
<span class="linenos"> 285</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="linenos"> 286</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit_len</span><span class="p">)</span>
<span class="linenos"> 287</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bit_len</span><span class="p">)</span>
<span class="linenos"> 288</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
<span class="linenos"> 289</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 290</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 291</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="linenos"> 292</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 293</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
<span class="linenos"> 294</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_len</span>
<span class="linenos"> 295</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_len</span>
<span class="linenos"> 296</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="linenos"> 297</span>        <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 298</span>        <span class="k">return</span> <span class="n">end</span>
<span class="linenos"> 299</span>
<span class="linenos"> 300</span>    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 301</span><span class="w">        </span><span class="sd">"""``k`` 番目に ``v`` を挿入します。</span>
<span class="linenos"> 302</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 303</span>
<span class="linenos"> 304</span><span class="sd">        Args:</span>
<span class="linenos"> 305</span><span class="sd">          k (int): 挿入位置のインデックスです。</span>
<span class="linenos"> 306</span><span class="sd">          key (int): 挿入する値です。 ``0`` または ``1`` である必要があります。</span>
<span class="linenos"> 307</span><span class="sd">        """</span>
<span class="linenos"> 308</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 309</span>            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 310</span>            <span class="k">return</span>
<span class="linenos"> 311</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 312</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 313</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 314</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 315</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 316</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 317</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 318</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 319</span>        <span class="p">)</span>
<span class="linenos"> 320</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 321</span>        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 322</span>        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 323</span>        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 324</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 325</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 326</span>                <span class="k">break</span>
<span class="linenos"> 327</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 328</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 329</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 330</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 331</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="k">else</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 332</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 333</span>                <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 334</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 335</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 336</span>        <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 337</span>        <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 338</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 339</span>            <span class="n">bl</span> <span class="o">=</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span>
<span class="linenos"> 340</span>            <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 341</span>            <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 342</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 343</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 344</span>            <span class="k">return</span>
<span class="linenos"> 345</span>        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 346</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 347</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 348</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 349</span>        <span class="n">bl</span> <span class="o">=</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span> <span class="o">-</span> <span class="n">k</span>
<span class="linenos"> 350</span>        <span class="n">v</span> <span class="o">=</span> <span class="p">(((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 351</span>        <span class="n">left_key</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span>
<span class="linenos"> 352</span>        <span class="n">left_key_popcount</span> <span class="o">=</span> <span class="n">left_key</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 353</span>        <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 354</span>        <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 355</span>        <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 356</span>        <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 357</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 358</span>            <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 359</span>                <span class="n">bit_len</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 360</span>                <span class="n">keys</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">left_key</span>
<span class="linenos"> 361</span>                <span class="k">return</span>
<span class="linenos"> 362</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 363</span>                <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 364</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 365</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 366</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 367</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">left_key_popcount</span>
<span class="linenos"> 368</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 369</span>            <span class="k">while</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 370</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 371</span>                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 372</span>                <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 373</span>                <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">left_key_popcount</span>
<span class="linenos"> 374</span>                <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 375</span>            <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 376</span>                <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 377</span>                <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">left_key</span>
<span class="linenos"> 378</span>                <span class="k">return</span>
<span class="linenos"> 379</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 380</span>                <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 381</span>        <span class="n">new_node</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 382</span>        <span class="k">while</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 383</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 384</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 385</span>            <span class="n">d</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 386</span>            <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 387</span>                <span class="k">break</span>
<span class="linenos"> 388</span>            <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 389</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 390</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_LR</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 391</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 392</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_L</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 393</span>                <span class="p">)</span>
<span class="linenos"> 394</span>                <span class="k">break</span>
<span class="linenos"> 395</span>            <span class="k">elif</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 396</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 397</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_RL</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 398</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="linenos"> 399</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_R</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 400</span>                <span class="p">)</span>
<span class="linenos"> 401</span>                <span class="k">break</span>
<span class="linenos"> 402</span>        <span class="k">if</span> <span class="n">new_node</span><span class="p">:</span>
<span class="linenos"> 403</span>            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 404</span>                <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 405</span>                    <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 406</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 407</span>                    <span class="n">right</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 408</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 409</span>                <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 410</span>
<span class="linenos"> 411</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_pop_under</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">res</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 412</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 413</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 414</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 415</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 416</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 417</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 418</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 419</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 420</span>        <span class="p">)</span>
<span class="linenos"> 421</span>        <span class="n">fd</span><span class="p">,</span> <span class="n">lmax_total</span><span class="p">,</span> <span class="n">lmax_bit_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="linenos"> 422</span>        <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="ow">and</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 423</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 424</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 425</span>            <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 426</span>            <span class="n">lmax</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 427</span>            <span class="k">while</span> <span class="n">right</span><span class="p">[</span><span class="n">lmax</span><span class="p">]:</span>
<span class="linenos"> 428</span>                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lmax</span><span class="p">)</span>
<span class="linenos"> 429</span>                <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 430</span>                <span class="n">fd</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 431</span>                <span class="n">fd</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 432</span>                <span class="n">lmax</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">lmax</span><span class="p">]</span>
<span class="linenos"> 433</span>            <span class="n">lmax_total</span> <span class="o">=</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">lmax</span><span class="p">])</span>
<span class="linenos"> 434</span>            <span class="n">lmax_bit_len</span> <span class="o">=</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">lmax</span><span class="p">]</span>
<span class="linenos"> 435</span>            <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">lmax</span><span class="p">]</span>
<span class="linenos"> 436</span>            <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmax_bit_len</span>
<span class="linenos"> 437</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">lmax</span>
<span class="linenos"> 438</span>        <span class="n">cnode</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 439</span>        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 440</span>            <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 441</span>                <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cnode</span>
<span class="linenos"> 442</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 443</span>                <span class="n">right</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">cnode</span>
<span class="linenos"> 444</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 445</span>            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">cnode</span>
<span class="linenos"> 446</span>            <span class="k">return</span>
<span class="linenos"> 447</span>        <span class="k">while</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 448</span>            <span class="n">new_node</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 449</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 450</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 451</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lmax_bit_len</span> <span class="k">if</span> <span class="n">fd</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
<span class="linenos"> 452</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lmax_total</span> <span class="k">if</span> <span class="n">fd</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">res</span>
<span class="linenos"> 453</span>            <span class="n">d</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 454</span>            <span class="n">fd</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 455</span>            <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 456</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 457</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_LR</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 458</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="linenos"> 459</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_L</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 460</span>                <span class="p">)</span>
<span class="linenos"> 461</span>            <span class="k">elif</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 462</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 463</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_RL</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 464</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="linenos"> 465</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_R</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 466</span>                <span class="p">)</span>
<span class="linenos"> 467</span>            <span class="k">elif</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 468</span>                <span class="k">break</span>
<span class="linenos"> 469</span>            <span class="k">if</span> <span class="n">new_node</span><span class="p">:</span>
<span class="linenos"> 470</span>                <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 471</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 472</span>                    <span class="k">return</span>
<span class="linenos"> 473</span>                <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 474</span>                    <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 475</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 476</span>                    <span class="n">right</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 477</span>                <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">new_node</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 478</span>                    <span class="k">break</span>
<span class="linenos"> 479</span>        <span class="k">while</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 480</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 481</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lmax_bit_len</span> <span class="k">if</span> <span class="n">fd</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">1</span>
<span class="linenos"> 482</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lmax_total</span> <span class="k">if</span> <span class="n">fd</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">res</span>
<span class="linenos"> 483</span>            <span class="n">fd</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 484</span>
<span class="linenos"> 485</span>    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 486</span><span class="w">        </span><span class="sd">"""``k`` 番目の要素を削除し、その値を返します。</span>
<span class="linenos"> 487</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 488</span>
<span class="linenos"> 489</span><span class="sd">        Args:</span>
<span class="linenos"> 490</span><span class="sd">          k (int): 削除位置のインデックスです。</span>
<span class="linenos"> 491</span><span class="sd">        """</span>
<span class="linenos"> 492</span>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 493</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos"> 494</span>        <span class="n">bit_len</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
<span class="linenos"> 495</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 496</span>        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 497</span>        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 498</span>        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 499</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 500</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 501</span>                <span class="k">break</span>
<span class="linenos"> 502</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 503</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="k">else</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 504</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 505</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 506</span>                <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 507</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 508</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 509</span>        <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 510</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 511</span>        <span class="n">res</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 512</span>        <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 513</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_pop_under</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="linenos"> 514</span>            <span class="k">return</span> <span class="n">res</span>
<span class="linenos"> 515</span>        <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">|</span> <span class="p">(</span>
<span class="linenos"> 516</span>            <span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 517</span>        <span class="p">)</span>
<span class="linenos"> 518</span>        <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 519</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 520</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">res</span>
<span class="linenos"> 521</span>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 522</span>            <span class="n">size</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 523</span>            <span class="n">total</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-=</span> <span class="n">res</span>
<span class="linenos"> 524</span>        <span class="k">return</span> <span class="n">res</span>
<span class="linenos"> 525</span>
<span class="linenos"> 526</span>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 527</span><span class="w">        </span><span class="sd">"""``k`` 番目の値を ``v`` に更新します。</span>
<span class="linenos"> 528</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 529</span>
<span class="linenos"> 530</span><span class="sd">        Args:</span>
<span class="linenos"> 531</span><span class="sd">          k (int): 更新位置のインデックスです。</span>
<span class="linenos"> 532</span><span class="sd">          key (int): 更新する値です。 ``0`` または ``1`` である必要があります。</span>
<span class="linenos"> 533</span><span class="sd">        """</span>
<span class="linenos"> 534</span>        <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="linenos"> 535</span>
<span class="linenos"> 536</span>    <span class="k">def</span><span class="w"> </span><span class="nf">tolist</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="linenos"> 537</span><span class="w">        </span><span class="sd">"""リストにして返します。</span>
<span class="linenos"> 538</span><span class="sd">        :math:`O(n)` です。</span>
<span class="linenos"> 539</span><span class="sd">        """</span>
<span class="linenos"> 540</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">bit_len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span>
<span class="linenos"> 541</span>        <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 542</span>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
<span class="linenos"> 543</span>            <span class="k">return</span> <span class="n">a</span>
<span class="linenos"> 544</span>
<span class="linenos"> 545</span>        <span class="k">def</span><span class="w"> </span><span class="nf">rec</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
<span class="linenos"> 546</span>            <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 547</span>                <span class="n">rec</span><span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 548</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos"> 549</span>                <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="n">i</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 550</span>            <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 551</span>                <span class="n">rec</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 552</span>
<span class="linenos"> 553</span>        <span class="n">rec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<span class="linenos"> 554</span>        <span class="k">return</span> <span class="n">a</span>
<span class="linenos"> 555</span>
<span class="linenos"> 556</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_debug_acc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 557</span><span class="w">        </span><span class="sd">"""デバッグ用のメソッドです。</span>
<span class="linenos"> 558</span><span class="sd">        key,totalをチェックします。</span>
<span class="linenos"> 559</span><span class="sd">        """</span>
<span class="linenos"> 560</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
<span class="linenos"> 561</span>        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span>
<span class="linenos"> 562</span>
<span class="linenos"> 563</span>        <span class="k">def</span><span class="w"> </span><span class="nf">rec</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
<span class="linenos"> 564</span>            <span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 565</span>            <span class="k">if</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 566</span>                <span class="n">acc</span> <span class="o">+=</span> <span class="n">rec</span><span class="p">(</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 567</span>            <span class="k">if</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 568</span>                <span class="n">acc</span> <span class="o">+=</span> <span class="n">rec</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 569</span>            <span class="k">if</span> <span class="n">acc</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 570</span>                <span class="c1"># self.debug()</span>
<span class="linenos"> 571</span>                <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"acc Error"</span>
<span class="linenos"> 572</span>            <span class="k">return</span> <span class="n">acc</span>
<span class="linenos"> 573</span>
<span class="linenos"> 574</span>        <span class="n">rec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
<span class="linenos"> 575</span>        <span class="nb">print</span><span class="p">(</span><span class="s2">"debug_acc ok."</span><span class="p">)</span>
<span class="linenos"> 576</span>
<span class="linenos"> 577</span>    <span class="k">def</span><span class="w"> </span><span class="nf">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 578</span><span class="w">        </span><span class="sd">"""``k`` 番目の値を返します。</span>
<span class="linenos"> 579</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 580</span>
<span class="linenos"> 581</span><span class="sd">        Args:</span>
<span class="linenos"> 582</span><span class="sd">          k (int): 取得位置のインデックスです。</span>
<span class="linenos"> 583</span><span class="sd">        """</span>
<span class="linenos"> 584</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos"> 585</span>
<span class="linenos"> 586</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 587</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``0`` の個数を返します。</span>
<span class="linenos"> 588</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 589</span><span class="sd">        """</span>
<span class="linenos"> 590</span>        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pref</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 591</span>
<span class="linenos"> 592</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 593</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``1`` の個数を返します。</span>
<span class="linenos"> 594</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 595</span><span class="sd">        """</span>
<span class="linenos"> 596</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pref</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 597</span>
<span class="linenos"> 598</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 599</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``v`` の個数を返します。</span>
<span class="linenos"> 600</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 601</span><span class="sd">        """</span>
<span class="linenos"> 602</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 603</span>
<span class="linenos"> 604</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 605</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``0`` のインデックスを返します。</span>
<span class="linenos"> 606</span><span class="sd">        :math:`O(\\log{n}^2)` です。</span>
<span class="linenos"> 607</span><span class="sd">        """</span>
<span class="linenos"> 608</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 609</span>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 610</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 611</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 612</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 613</span>            <span class="k">if</span> <span class="n">m</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pref</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 614</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 615</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 616</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 617</span>        <span class="k">return</span> <span class="n">l</span>
<span class="linenos"> 618</span>
<span class="linenos"> 619</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 620</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``1`` のインデックスを返します。</span>
<span class="linenos"> 621</span><span class="sd">        :math:`O(\\log{n}^2)` です。</span>
<span class="linenos"> 622</span><span class="sd">        """</span>
<span class="linenos"> 623</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 624</span>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 625</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 626</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 627</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 628</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pref</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 629</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 630</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 631</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 632</span>        <span class="k">return</span> <span class="n">l</span>
<span class="linenos"> 633</span>
<span class="linenos"> 634</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 635</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``v`` のインデックスを返します。</span>
<span class="linenos"> 636</span><span class="sd">        :math:`O(\\log{n}^2)` です。</span>
<span class="linenos"> 637</span><span class="sd">        """</span>
<span class="linenos"> 638</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">select0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos"> 639</span>
<span class="linenos"> 640</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_insert_and_rank1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 641</span>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 642</span>            <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 643</span>            <span class="k">return</span> <span class="mi">0</span>
<span class="linenos"> 644</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">balance</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 645</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 646</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 647</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 648</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 649</span>            <span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">,</span>
<span class="linenos"> 650</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 651</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 652</span>        <span class="p">)</span>
<span class="linenos"> 653</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 654</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 655</span>        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 656</span>        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 657</span>        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 658</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 659</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 660</span>                <span class="k">break</span>
<span class="linenos"> 661</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 662</span>                <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 663</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 664</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 665</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 666</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 667</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="k">else</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 668</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 669</span>                <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 670</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 671</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 672</span>        <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 673</span>        <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span>
<span class="linenos"> 674</span>            <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
<span class="linenos"> 675</span>        <span class="p">)</span>
<span class="linenos"> 676</span>        <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 677</span>            <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 678</span>            <span class="n">bl</span> <span class="o">=</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span>
<span class="linenos"> 679</span>            <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 680</span>            <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 681</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 682</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 683</span>            <span class="k">return</span> <span class="n">s</span>
<span class="linenos"> 684</span>        <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 685</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 686</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">key</span>
<span class="linenos"> 687</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 688</span>        <span class="n">bl</span> <span class="o">=</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span> <span class="o">-</span> <span class="n">k</span>
<span class="linenos"> 689</span>        <span class="n">v</span> <span class="o">=</span> <span class="p">(((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">key</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bl</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 690</span>        <span class="n">left_key</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span>
<span class="linenos"> 691</span>        <span class="n">left_key_popcount</span> <span class="o">=</span> <span class="n">left_key</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 692</span>        <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 693</span>        <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 694</span>        <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 695</span>        <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 696</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 697</span>            <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 698</span>                <span class="n">bit_len</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 699</span>                <span class="n">keys</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">left_key</span>
<span class="linenos"> 700</span>                <span class="k">return</span> <span class="n">s</span>
<span class="linenos"> 701</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 702</span>                <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 703</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 704</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 705</span>            <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 706</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">left_key_popcount</span>
<span class="linenos"> 707</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 708</span>            <span class="k">while</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]:</span>
<span class="linenos"> 709</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 710</span>                <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 711</span>                <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 712</span>                <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="n">left_key_popcount</span>
<span class="linenos"> 713</span>                <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 714</span>            <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">titan_pylib_AVLTreeBitVector_W</span><span class="p">:</span>
<span class="linenos"> 715</span>                <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos"> 716</span>                <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">left_key</span>
<span class="linenos"> 717</span>                <span class="k">return</span> <span class="n">s</span>
<span class="linenos"> 718</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 719</span>                <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_node</span><span class="p">(</span><span class="n">left_key</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 720</span>        <span class="n">new_node</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 721</span>        <span class="k">while</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 722</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 723</span>            <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 724</span>            <span class="n">d</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span>
<span class="linenos"> 725</span>            <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 726</span>                <span class="k">break</span>
<span class="linenos"> 727</span>            <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 728</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 729</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_LR</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 730</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 731</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_L</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 732</span>                <span class="p">)</span>
<span class="linenos"> 733</span>                <span class="k">break</span>
<span class="linenos"> 734</span>            <span class="k">elif</span> <span class="n">balance</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
<span class="linenos"> 735</span>                <span class="n">new_node</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 736</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_RL</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 737</span>                    <span class="k">if</span> <span class="n">balance</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="linenos"> 738</span>                    <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rotate_R</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 739</span>                <span class="p">)</span>
<span class="linenos"> 740</span>                <span class="k">break</span>
<span class="linenos"> 741</span>        <span class="k">if</span> <span class="n">new_node</span><span class="p">:</span>
<span class="linenos"> 742</span>            <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 743</span>                <span class="k">if</span> <span class="n">d</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 744</span>                    <span class="n">left</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 745</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 746</span>                    <span class="n">right</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 747</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 748</span>                <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">new_node</span>
<span class="linenos"> 749</span>        <span class="k">return</span> <span class="n">s</span>
<span class="linenos"> 750</span>
<span class="linenos"> 751</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_access_pop_and_rank1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 752</span>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 753</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos"> 754</span>        <span class="n">bit_len</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total</span>
<span class="linenos"> 755</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 756</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 757</span>        <span class="n">d</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 758</span>        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 759</span>        <span class="k">while</span> <span class="n">node</span><span class="p">:</span>
<span class="linenos"> 760</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 761</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 762</span>                <span class="k">break</span>
<span class="linenos"> 763</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 764</span>                <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 765</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 766</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="k">else</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 767</span>            <span class="n">d</span> <span class="o">&lt;&lt;=</span> <span class="mi">1</span>
<span class="linenos"> 768</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 769</span>                <span class="n">d</span> <span class="o">|=</span> <span class="mi">1</span>
<span class="linenos"> 770</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 771</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 772</span>        <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 773</span>        <span class="n">s</span> <span class="o">+=</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span>
<span class="linenos"> 774</span>            <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span>
<span class="linenos"> 775</span>        <span class="p">)</span>
<span class="linenos"> 776</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 777</span>        <span class="n">res</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 778</span>        <span class="k">if</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 779</span>            <span class="bp">self</span><span class="o">.</span><span class="n">_pop_under</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
<span class="linenos"> 780</span>            <span class="k">return</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">res</span>
<span class="linenos"> 781</span>        <span class="n">keys</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">v</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span> <span class="o">|</span> <span class="p">(</span>
<span class="linenos"> 782</span>            <span class="n">v</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 783</span>        <span class="p">)</span>
<span class="linenos"> 784</span>        <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 785</span>        <span class="n">size</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 786</span>        <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-=</span> <span class="n">res</span>
<span class="linenos"> 787</span>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 788</span>            <span class="n">size</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos"> 789</span>            <span class="n">total</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">-=</span> <span class="n">res</span>
<span class="linenos"> 790</span>        <span class="k">return</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span> <span class="o">|</span> <span class="n">res</span>
<span class="linenos"> 791</span>
<span class="linenos"> 792</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 793</span><span class="w">        </span><span class="sd">"""``k`` 番目の要素を返します。</span>
<span class="linenos"> 794</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 795</span><span class="sd">        """</span>
<span class="linenos"> 796</span>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<span class="linenos"> 797</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 798</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 799</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 800</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 801</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 802</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 803</span>        <span class="p">)</span>
<span class="linenos"> 804</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 805</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 806</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 807</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 808</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 809</span>                <span class="k">return</span> <span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 810</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 811</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 812</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 813</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 814</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 815</span>
<span class="linenos"> 816</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 817</span><span class="w">        </span><span class="sd">"""``k`` 番目の要素を ``v`` に更新します。</span>
<span class="linenos"> 818</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 819</span><span class="sd">        """</span>
<span class="linenos"> 820</span>        <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">bit_len</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 821</span>            <span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="p">,</span>
<span class="linenos"> 822</span>            <span class="bp">self</span><span class="o">.</span><span class="n">right</span><span class="p">,</span>
<span class="linenos"> 823</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit_len</span><span class="p">,</span>
<span class="linenos"> 824</span>            <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
<span class="linenos"> 825</span>            <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
<span class="linenos"> 826</span>            <span class="bp">self</span><span class="o">.</span><span class="n">total</span><span class="p">,</span>
<span class="linenos"> 827</span>        <span class="p">)</span>
<span class="linenos"> 828</span>        <span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"ValueError"</span>
<span class="linenos"> 829</span>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span>
<span class="linenos"> 830</span>        <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos"> 831</span>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="linenos"> 832</span>            <span class="n">t</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span> <span class="o">+</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 833</span>            <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
<span class="linenos"> 834</span>            <span class="k">if</span> <span class="n">t</span> <span class="o">-</span> <span class="n">bit_len</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
<span class="linenos"> 835</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">size</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 836</span>                <span class="k">if</span> <span class="n">v</span><span class="p">:</span>
<span class="linenos"> 837</span>                    <span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span>
<span class="linenos"> 838</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 839</span>                    <span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">k</span><span class="p">)</span>
<span class="linenos"> 840</span>                <span class="k">break</span>
<span class="linenos"> 841</span>            <span class="k">elif</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 842</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 843</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 844</span>                <span class="n">node</span> <span class="o">=</span> <span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]</span>
<span class="linenos"> 845</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">t</span>
<span class="linenos"> 846</span>        <span class="k">while</span> <span class="n">path</span><span class="p">:</span>
<span class="linenos"> 847</span>            <span class="n">node</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="linenos"> 848</span>            <span class="n">total</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
<span class="linenos"> 849</span>                <span class="n">AVLTreeBitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="n">node</span><span class="p">])</span>
<span class="linenos"> 850</span>                <span class="o">+</span> <span class="n">total</span><span class="p">[</span><span class="n">left</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 851</span>                <span class="o">+</span> <span class="n">total</span><span class="p">[</span><span class="n">right</span><span class="p">[</span><span class="n">node</span><span class="p">]]</span>
<span class="linenos"> 852</span>            <span class="p">)</span>
<span class="linenos"> 853</span>
<span class="linenos"> 854</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 855</span>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="linenos"> 856</span>
<span class="linenos"> 857</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 858</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">]</span>
<span class="linenos"> 859</span>
<span class="linenos"> 860</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos"> 861</span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos"> 862</span><span class="c1"># from titan_pylib.data_structures.wavelet_matrix.wavelet_matrix import WaveletMatrix</span>
<span class="linenos"> 863</span><span class="c1"># from titan_pylib.data_structures.bit_vector.bit_vector import BitVector</span>
<span class="linenos"> 864</span><span class="c1"># from titan_pylib.data_structures.bit_vector.bit_vector_interface import (</span>
<span class="linenos"> 865</span><span class="c1">#     BitVectorInterface,</span>
<span class="linenos"> 866</span><span class="c1"># )</span>
<span class="linenos"> 867</span><span class="kn">from</span><span class="w"> </span><span class="nn">array</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="linenos"> 868</span>
<span class="linenos"> 869</span>
<span class="linenos"> 870</span><span class="k">class</span><span class="w"> </span><span class="nc">BitVector</span><span class="p">(</span><span class="n">BitVectorInterface</span><span class="p">):</span>
<span class="linenos"> 871</span><span class="w">    </span><span class="sd">"""コンパクトな bit vector です。"""</span>
<span class="linenos"> 872</span>
<span class="linenos"> 873</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos"> 874</span><span class="w">        </span><span class="sd">"""長さ ``n`` の ``BitVector`` です。</span>
<span class="linenos"> 875</span>
<span class="linenos"> 876</span><span class="sd">        bit を保持するのに ``array[I]`` を使用します。</span>
<span class="linenos"> 877</span><span class="sd">        ``block_size= n / 32`` として、使用bitは ``32*block_size=2n bit`` です。</span>
<span class="linenos"> 878</span>
<span class="linenos"> 879</span><span class="sd">        累積和を保持するのに同様の ``array[I]`` を使用します。</span>
<span class="linenos"> 880</span><span class="sd">        32bitごとの和を保存しています。同様に使用bitは ``2n bit`` です。</span>
<span class="linenos"> 881</span><span class="sd">        """</span>
<span class="linenos"> 882</span>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">4294967295</span>
<span class="linenos"> 883</span>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">n</span>
<span class="linenos"> 884</span>        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">31</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span>
<span class="linenos"> 885</span>        <span class="n">b</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 886</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bit</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos"> 887</span>        <span class="bp">self</span><span class="o">.</span><span class="n">acc</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="linenos"> 888</span>
<span class="linenos"> 889</span>    <span class="nd">@staticmethod</span>
<span class="linenos"> 890</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_popcount</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 891</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x55555555</span><span class="p">)</span>
<span class="linenos"> 892</span>        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x33333333</span><span class="p">)</span>
<span class="linenos"> 893</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0F0F0F0F</span>
<span class="linenos"> 894</span>        <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span>
<span class="linenos"> 895</span>        <span class="n">x</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span>
<span class="linenos"> 896</span>        <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0x0000007F</span>
<span class="linenos"> 897</span>
<span class="linenos"> 898</span>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 899</span><span class="w">        </span><span class="sd">"""``k`` 番目の bit を ``1`` にします。</span>
<span class="linenos"> 900</span><span class="sd">        :math:`O(1)` です。</span>
<span class="linenos"> 901</span>
<span class="linenos"> 902</span><span class="sd">        Args:</span>
<span class="linenos"> 903</span><span class="sd">          k (int): インデックスです。</span>
<span class="linenos"> 904</span><span class="sd">        """</span>
<span class="linenos"> 905</span>        <span class="bp">self</span><span class="o">.</span><span class="n">bit</span><span class="p">[</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">)</span>
<span class="linenos"> 906</span>
<span class="linenos"> 907</span>    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos"> 908</span><span class="w">        </span><span class="sd">"""構築します。</span>
<span class="linenos"> 909</span><span class="sd">        **これ以降 ``set`` メソッドを使用してはいけません。**</span>
<span class="linenos"> 910</span><span class="sd">        :math:`O(n)` です。</span>
<span class="linenos"> 911</span><span class="sd">        """</span>
<span class="linenos"> 912</span>        <span class="n">acc</span><span class="p">,</span> <span class="n">bit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bit</span>
<span class="linenos"> 913</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">):</span>
<span class="linenos"> 914</span>            <span class="n">acc</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">BitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="n">bit</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="linenos"> 915</span>
<span class="linenos"> 916</span>    <span class="k">def</span><span class="w"> </span><span class="nf">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 917</span><span class="w">        </span><span class="sd">"""``k`` 番目の bit を返します。</span>
<span class="linenos"> 918</span><span class="sd">        :math:`O(1)` です。</span>
<span class="linenos"> 919</span><span class="sd">        """</span>
<span class="linenos"> 920</span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit</span><span class="p">[</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 921</span>
<span class="linenos"> 922</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 923</span>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit</span><span class="p">[</span><span class="n">k</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">k</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mi">1</span>
<span class="linenos"> 924</span>
<span class="linenos"> 925</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 926</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``0`` の個数を返します。</span>
<span class="linenos"> 927</span><span class="sd">        :math:`O(1)` です。</span>
<span class="linenos"> 928</span><span class="sd">        """</span>
<span class="linenos"> 929</span>        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="p">(</span>
<span class="linenos"> 930</span>            <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span>
<span class="linenos"> 931</span>            <span class="o">+</span> <span class="n">BitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bit</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos"> 932</span>        <span class="p">)</span>
<span class="linenos"> 933</span>
<span class="linenos"> 934</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 935</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``1`` の個数を返します。</span>
<span class="linenos"> 936</span><span class="sd">        :math:`O(1)` です。</span>
<span class="linenos"> 937</span><span class="sd">        """</span>
<span class="linenos"> 938</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">BitVector</span><span class="o">.</span><span class="n">_popcount</span><span class="p">(</span>
<span class="linenos"> 939</span>            <span class="bp">self</span><span class="o">.</span><span class="n">bit</span><span class="p">[</span><span class="n">r</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&amp;</span> <span class="mi">31</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos"> 940</span>        <span class="p">)</span>
<span class="linenos"> 941</span>
<span class="linenos"> 942</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 943</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``v`` の個数を返します。</span>
<span class="linenos"> 944</span><span class="sd">        :math:`O(1)` です。</span>
<span class="linenos"> 945</span><span class="sd">        """</span>
<span class="linenos"> 946</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos"> 947</span>
<span class="linenos"> 948</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 949</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``0`` のインデックスを返します。</span>
<span class="linenos"> 950</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 951</span><span class="sd">        """</span>
<span class="linenos"> 952</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 953</span>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 954</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos"> 955</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 956</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 957</span>            <span class="k">if</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">32</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 958</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 959</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 960</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 961</span>        <span class="n">indx</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">l</span>
<span class="linenos"> 962</span>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="mi">32</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">l</span><span class="p">])</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
<span class="linenos"> 963</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">indx</span><span class="p">,</span> <span class="n">indx</span> <span class="o">+</span> <span class="mi">32</span>
<span class="linenos"> 964</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 965</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 966</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 967</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 968</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 969</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 970</span>        <span class="k">return</span> <span class="n">l</span>
<span class="linenos"> 971</span>
<span class="linenos"> 972</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 973</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``1`` のインデックスを返します。</span>
<span class="linenos"> 974</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 975</span><span class="sd">        """</span>
<span class="linenos"> 976</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 977</span>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<span class="linenos"> 978</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">+</span> <span class="mi">1</span>
<span class="linenos"> 979</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 980</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 981</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 982</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 983</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 984</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 985</span>        <span class="n">indx</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">*</span> <span class="n">l</span>
<span class="linenos"> 986</span>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span>
<span class="linenos"> 987</span>        <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">indx</span><span class="p">,</span> <span class="n">indx</span> <span class="o">+</span> <span class="mi">32</span>
<span class="linenos"> 988</span>        <span class="k">while</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos"> 989</span>            <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">r</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos"> 990</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">k</span><span class="p">:</span>
<span class="linenos"> 991</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 992</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos"> 993</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">m</span>
<span class="linenos"> 994</span>        <span class="k">return</span> <span class="n">l</span>
<span class="linenos"> 995</span>
<span class="linenos"> 996</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos"> 997</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``v`` のインデックスを返します。</span>
<span class="linenos"> 998</span><span class="sd">        :math:`O(\\log{n})` です。</span>
<span class="linenos"> 999</span><span class="sd">        """</span>
<span class="linenos">1000</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">select1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">select0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">1001</span>
<span class="linenos">1002</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1003</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
<span class="linenos">1004</span>
<span class="linenos">1005</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1006</span>        <span class="k">return</span> <span class="nb">str</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)])</span>
<span class="linenos">1007</span>
<span class="linenos">1008</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1009</span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1010</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
<span class="linenos">1011</span><span class="kn">from</span><span class="w"> </span><span class="nn">heapq</span><span class="w"> </span><span class="kn">import</span> <span class="n">heappush</span><span class="p">,</span> <span class="n">heappop</span>
<span class="linenos">1012</span><span class="kn">from</span><span class="w"> </span><span class="nn">array</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="linenos">1013</span>
<span class="linenos">1014</span>
<span class="linenos">1015</span><span class="k">class</span><span class="w"> </span><span class="nc">WaveletMatrix</span><span class="p">:</span>
<span class="linenos">1016</span><span class="w">    </span><span class="sd">"""``WaveletMatrix`` です。</span>
<span class="linenos">1017</span><span class="sd">    静的であることに注意してください。</span>
<span class="linenos">1018</span>
<span class="linenos">1019</span><span class="sd">    以下の仕様の計算量には嘘があるかもしれません。import 元の ``BitVector`` の計算量も参考にしてください。</span>
<span class="linenos">1020</span>
<span class="linenos">1021</span><span class="sd">    参考:</span>
<span class="linenos">1022</span><span class="sd">      `https://miti-7.hatenablog.com/entry/2018/04/28/152259 &lt;https://miti-7.hatenablog.com/entry/2018/04/28/152259&gt;`_</span>
<span class="linenos">1023</span><span class="sd">      `https://www.slideshare.net/pfi/ss-15916040 &lt;https://www.slideshare.net/pfi/ss-15916040&gt;`_</span>
<span class="linenos">1024</span><span class="sd">      `デwiki &lt;https://scrapbox.io/data-structures/Wavelet_Matrix&gt;`_</span>
<span class="linenos">1025</span><span class="sd">    """</span>
<span class="linenos">1026</span>
<span class="linenos">1027</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1028</span><span class="w">        </span><span class="sd">"""``[0, sigma)`` の整数列を管理する ``WaveletMatrix`` を構築します。</span>
<span class="linenos">1029</span><span class="sd">        :math:`O(n\\log{\\sigma})` です。</span>
<span class="linenos">1030</span>
<span class="linenos">1031</span><span class="sd">        Args:</span>
<span class="linenos">1032</span><span class="sd">            sigma (int): 扱う整数の上限です。</span>
<span class="linenos">1033</span><span class="sd">            a (Sequence[int], optional): 構築する配列です。</span>
<span class="linenos">1034</span><span class="sd">        """</span>
<span class="linenos">1035</span>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">sigma</span>
<span class="linenos">1036</span>        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="linenos">1037</span>        <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">:</span> <span class="n">array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">))</span>
<span class="linenos">1038</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">1039</span>        <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BitVector</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">BitVector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">)]</span>
<span class="linenos">1040</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">1041</span>
<span class="linenos">1042</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1043</span>        <span class="c1"># 列 a から wm を構築する</span>
<span class="linenos">1044</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1045</span>            <span class="c1"># bit目の0/1に応じてvを構築 + aを安定ソート</span>
<span class="linenos">1046</span>            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1047</span>            <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="linenos">1048</span>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="linenos">1049</span>                <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1050</span>                    <span class="n">v</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos">1051</span>                    <span class="n">one</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">1052</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1053</span>                    <span class="n">zero</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">1054</span>            <span class="n">v</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="linenos">1055</span>            <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span>  <span class="c1"># 境界をmid[bit]に保持</span>
<span class="linenos">1056</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">zero</span> <span class="o">+</span> <span class="n">one</span>
<span class="linenos">1057</span>
<span class="linenos">1058</span>    <span class="k">def</span><span class="w"> </span><span class="nf">access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1059</span><span class="w">        </span><span class="sd">"""``k`` 番目の値を返します。</span>
<span class="linenos">1060</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1061</span>
<span class="linenos">1062</span><span class="sd">        Args:</span>
<span class="linenos">1063</span><span class="sd">            k (int): インデックスです。</span>
<span class="linenos">1064</span><span class="sd">        """</span>
<span class="linenos">1065</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1066</span>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1067</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.access(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1068</span>        <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1069</span>            <span class="n">k</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1070</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 答え</span>
<span class="linenos">1071</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1072</span>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<span class="linenos">1073</span>                <span class="c1"># k番目が立ってたら、</span>
<span class="linenos">1074</span>                <span class="c1"># kまでの1とすべての0が次のk</span>
<span class="linenos">1075</span>                <span class="n">s</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span>
<span class="linenos">1076</span>                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1077</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1078</span>                <span class="c1"># kまでの0が次のk</span>
<span class="linenos">1079</span>                <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">1080</span>        <span class="k">return</span> <span class="n">s</span>
<span class="linenos">1081</span>
<span class="linenos">1082</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1083</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1084</span>            <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1085</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">], size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1086</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">1087</span>
<span class="linenos">1088</span>    <span class="k">def</span><span class="w"> </span><span class="nf">rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1089</span><span class="w">        </span><span class="sd">"""``a[0, r)`` に含まれる ``x`` の個数を返します。</span>
<span class="linenos">1090</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1091</span><span class="sd">        """</span>
<span class="linenos">1092</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1093</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1094</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.rank(), r=</span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1095</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1096</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1097</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.rank(), x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, LIM=</span><span class="si">{</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1098</span>        <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1099</span>        <span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
<span class="linenos">1100</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1101</span>            <span class="c1"># 位置 r より左に x が何個あるか</span>
<span class="linenos">1102</span>            <span class="c1"># x の bit 目で場合分け</span>
<span class="linenos">1103</span>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1104</span>                <span class="c1"># 立ってたら、次のl, rは以下</span>
<span class="linenos">1105</span>                <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1106</span>                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1107</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1108</span>                <span class="c1"># そうでなければ次のl, rは以下</span>
<span class="linenos">1109</span>                <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="linenos">1110</span>                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos">1111</span>        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span>
<span class="linenos">1112</span>
<span class="linenos">1113</span>    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1114</span><span class="w">        </span><span class="sd">"""``k`` 番目の ``v`` のインデックスを返します。</span>
<span class="linenos">1115</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1116</span><span class="sd">        """</span>
<span class="linenos">1117</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1118</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1119</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.select(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), k=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1120</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1121</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1122</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.select(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, LIM=</span><span class="si">{</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1123</span>        <span class="c1"># x の開始位置 s を探す</span>
<span class="linenos">1124</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1125</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1126</span>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1127</span>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="linenos">1128</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1129</span>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="linenos">1130</span>        <span class="n">s</span> <span class="o">+=</span> <span class="n">k</span>  <span class="c1"># s から k 進んだ位置が、元の列で何番目か調べる</span>
<span class="linenos">1131</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">):</span>
<span class="linenos">1132</span>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1133</span>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">select1</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
<span class="linenos">1134</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1135</span>                <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">select0</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="linenos">1136</span>        <span class="k">return</span> <span class="n">s</span>
<span class="linenos">1137</span>
<span class="linenos">1138</span>    <span class="k">def</span><span class="w"> </span><span class="nf">kth_smallest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1139</span><span class="w">        </span><span class="sd">"""``a[l, r)`` の中で ``k`` 番目に **小さい** 値を返します。</span>
<span class="linenos">1140</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1141</span><span class="sd">        """</span>
<span class="linenos">1142</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1143</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1144</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.kth_smallest(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1145</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1146</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span>
<span class="linenos">1147</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.kth_smallest(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), wrong k"</span>
<span class="linenos">1148</span>        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1149</span>        <span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
<span class="linenos">1150</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1151</span>            <span class="n">r0</span><span class="p">,</span> <span class="n">l0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="linenos">1152</span>            <span class="n">cnt</span> <span class="o">=</span> <span class="n">r0</span> <span class="o">-</span> <span class="n">l0</span>  <span class="c1"># 区間内の 0 の個数</span>
<span class="linenos">1153</span>            <span class="k">if</span> <span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">k</span><span class="p">:</span>  <span class="c1"># 0 が k 以下のとき、 k 番目は 1</span>
<span class="linenos">1154</span>                <span class="n">s</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span>
<span class="linenos">1155</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">cnt</span>
<span class="linenos">1156</span>                <span class="c1"># この 1 が次の bit 列でどこに行くか</span>
<span class="linenos">1157</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="n">l0</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1158</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">r0</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1159</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1160</span>                <span class="c1"># この 0 が次の bit 列でどこに行くか</span>
<span class="linenos">1161</span>                <span class="n">l</span> <span class="o">=</span> <span class="n">l0</span>
<span class="linenos">1162</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">r0</span>
<span class="linenos">1163</span>        <span class="k">return</span> <span class="n">s</span>
<span class="linenos">1164</span>
<span class="linenos">1165</span>    <span class="n">quantile</span> <span class="o">=</span> <span class="n">kth_smallest</span>
<span class="linenos">1166</span>
<span class="linenos">1167</span>    <span class="k">def</span><span class="w"> </span><span class="nf">kth_largest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1168</span><span class="w">        </span><span class="sd">"""``a[l, r)`` の中で ``k`` 番目に **大きい値** を返します。</span>
<span class="linenos">1169</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1170</span><span class="sd">        """</span>
<span class="linenos">1171</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1172</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1173</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.kth_largest(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1174</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1175</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span>
<span class="linenos">1176</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.kth_largest(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), wrong k"</span>
<span class="linenos">1177</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kth_smallest</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos">1178</span>
<span class="linenos">1179</span>    <span class="k">def</span><span class="w"> </span><span class="nf">topk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="linenos">1180</span><span class="w">        </span><span class="sd">"""``a[l, r)`` の中で、要素を出現回数が多い順にその頻度とともに ``k`` 個返します。</span>
<span class="linenos">1181</span><span class="sd">        :math:`O(\\min(r-l, \\sigam) \\log(\\sigam))` です。</span>
<span class="linenos">1182</span>
<span class="linenos">1183</span><span class="sd">        Note:</span>
<span class="linenos">1184</span><span class="sd">            :math:`\\sigma` が大きい場合、計算量に注意です。</span>
<span class="linenos">1185</span>
<span class="linenos">1186</span><span class="sd">        Returns:</span>
<span class="linenos">1187</span><span class="sd">            list[tuple[int, int]]: ``(要素, 頻度)`` を要素とする配列です。</span>
<span class="linenos">1188</span><span class="sd">        """</span>
<span class="linenos">1189</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1190</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1191</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.topk(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1192</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1193</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span>
<span class="linenos">1194</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.topk(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), wrong k"</span>
<span class="linenos">1195</span>        <span class="c1"># heap[-length, x, l, bit]</span>
<span class="linenos">1196</span>        <span class="n">hq</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
<span class="linenos">1197</span>        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">1198</span>        <span class="k">while</span> <span class="n">hq</span><span class="p">:</span>
<span class="linenos">1199</span>            <span class="n">length</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">bit</span> <span class="o">=</span> <span class="n">heappop</span><span class="p">(</span><span class="n">hq</span><span class="p">)</span>
<span class="linenos">1200</span>            <span class="n">length</span> <span class="o">=</span> <span class="o">-</span><span class="n">length</span>
<span class="linenos">1201</span>            <span class="k">if</span> <span class="n">bit</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
<span class="linenos">1202</span>                <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">length</span><span class="p">))</span>
<span class="linenos">1203</span>                <span class="n">k</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos">1204</span>                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">1205</span>                    <span class="k">break</span>
<span class="linenos">1206</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1207</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">length</span>
<span class="linenos">1208</span>                <span class="n">l0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="linenos">1209</span>                <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos">1210</span>                <span class="k">if</span> <span class="n">l0</span> <span class="o">&lt;</span> <span class="n">r0</span><span class="p">:</span>
<span class="linenos">1211</span>                    <span class="n">heappush</span><span class="p">(</span><span class="n">hq</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r0</span> <span class="o">-</span> <span class="n">l0</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">l0</span><span class="p">,</span> <span class="n">bit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">1212</span>                <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1213</span>                <span class="n">r1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank1</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1214</span>                <span class="k">if</span> <span class="n">l1</span> <span class="o">&lt;</span> <span class="n">r1</span><span class="p">:</span>
<span class="linenos">1215</span>                    <span class="n">heappush</span><span class="p">(</span><span class="n">hq</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r1</span> <span class="o">-</span> <span class="n">l1</span><span class="p">),</span> <span class="n">x</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span><span class="p">),</span> <span class="n">l1</span><span class="p">,</span> <span class="n">bit</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="linenos">1216</span>        <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">1217</span>
<span class="linenos">1218</span>    <span class="k">def</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1219</span><span class="w">        </span><span class="sd">"""``topk`` メソッドを用いて ``a[l, r)`` の総和を返します。</span>
<span class="linenos">1220</span><span class="sd">        計算量に注意です。</span>
<span class="linenos">1221</span><span class="sd">        """</span>
<span class="linenos">1222</span>        <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"Yabai Keisanryo Error"</span>
<span class="linenos">1223</span>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">topk</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="n">l</span><span class="p">))</span>
<span class="linenos">1224</span>
<span class="linenos">1225</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_range_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1226</span><span class="w">        </span><span class="sd">"""a[l, r) で x 未満の要素の数を返す"""</span>
<span class="linenos">1227</span>        <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1228</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1229</span>            <span class="n">l0</span><span class="p">,</span> <span class="n">r0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span><span class="o">.</span><span class="n">rank0</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="linenos">1230</span>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1231</span>                <span class="c1"># bit が立ってたら、区間の 0 の個数を答えに加算し、新たな区間は 1 のみ</span>
<span class="linenos">1232</span>                <span class="n">ans</span> <span class="o">+=</span> <span class="n">r0</span> <span class="o">-</span> <span class="n">l0</span>
<span class="linenos">1233</span>                <span class="c1"># 1 が次の bit 列でどこに行くか</span>
<span class="linenos">1234</span>                <span class="n">l</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">-</span> <span class="n">l0</span>
<span class="linenos">1235</span>                <span class="n">r</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">-</span> <span class="n">r0</span>
<span class="linenos">1236</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1237</span>                <span class="c1"># 0 が次の bit 列でどこに行くか</span>
<span class="linenos">1238</span>                <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">l0</span><span class="p">,</span> <span class="n">r0</span>
<span class="linenos">1239</span>        <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">1240</span>
<span class="linenos">1241</span>    <span class="k">def</span><span class="w"> </span><span class="nf">range_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1242</span><span class="w">        </span><span class="sd">"""``a[l, r)`` に含まれる、 ``x`` 以上 ``y`` 未満である要素の個数を返します。</span>
<span class="linenos">1243</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1244</span><span class="sd">        """</span>
<span class="linenos">1245</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1246</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1247</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.range_freq(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1248</span>        <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"ValueError"</span>
<span class="linenos">1249</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_freq</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_freq</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">1250</span>
<span class="linenos">1251</span>    <span class="k">def</span><span class="w"> </span><span class="nf">prev_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1252</span><span class="w">        </span><span class="sd">"""``a[l, r)`` で、``x`` 以上 ``y`` 未満であるような要素のうち最大の要素を返します。</span>
<span class="linenos">1253</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1254</span><span class="sd">        """</span>
<span class="linenos">1255</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1256</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1257</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.prev_value(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1258</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kth_smallest</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_freq</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos">1259</span>
<span class="linenos">1260</span>    <span class="k">def</span><span class="w"> </span><span class="nf">next_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1261</span><span class="w">        </span><span class="sd">"""``a[l, r)`` で、``x`` 以上 ``y`` 未満であるような要素のうち最小の要素を返します。</span>
<span class="linenos">1262</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1263</span><span class="sd">        """</span>
<span class="linenos">1264</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1265</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1266</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.next_value(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1267</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kth_smallest</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_range_freq</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="linenos">1268</span>
<span class="linenos">1269</span>    <span class="k">def</span><span class="w"> </span><span class="nf">range_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1270</span><span class="w">        </span><span class="sd">"""``a[l, r)`` に含まれる ``x`` の個数を返します。</span>
<span class="linenos">1271</span><span class="sd">        ``wm.rank(r, x) - wm.rank(l, x)`` と等価です。</span>
<span class="linenos">1272</span><span class="sd">        :math:`O(\\log{\\sigma})` です。</span>
<span class="linenos">1273</span><span class="sd">        """</span>
<span class="linenos">1274</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1275</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1276</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.range_count(</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1277</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">1278</span>
<span class="linenos">1279</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1280</span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1281</span>
<span class="linenos">1282</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="linenos">1283</span>        <span class="k">return</span> <span class="p">(</span>
<span class="linenos">1284</span>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1285</span>        <span class="p">)</span>
<span class="linenos">1286</span>
<span class="linenos">1287</span>    <span class="fm">__repr__</span> <span class="o">=</span> <span class="fm">__str__</span>
<span class="linenos">1288</span><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sequence</span>
<span class="linenos">1289</span><span class="kn">from</span><span class="w"> </span><span class="nn">array</span><span class="w"> </span><span class="kn">import</span> <span class="n">array</span>
<span class="linenos">1290</span>
<span class="linenos">1291</span>
<span class="linenos">1292</span><span class="k">class</span><span class="w"> </span><span class="nc">DynamicWaveletMatrix</span><span class="p">(</span><span class="n">WaveletMatrix</span><span class="p">):</span>
<span class="linenos">1293</span><span class="w">    </span><span class="sd">"""動的ウェーブレット行列です。</span>
<span class="linenos">1294</span>
<span class="linenos">1295</span><span class="sd">    (静的)ウェーブレット行列でできる操作に加えて ``insert / pop / set`` 等ができます。</span>
<span class="linenos">1296</span><span class="sd">      - ``BitVector`` を平衡二分木にしています(``AVLTreeBitVector``)。あらゆる操作に平衡二分木の log がつきます。これヤバくね</span>
<span class="linenos">1297</span>
<span class="linenos">1298</span><span class="sd">    :math:`O(n\\log{(\\sigma)})` です。</span>
<span class="linenos">1299</span><span class="sd">    """</span>
<span class="linenos">1300</span>
<span class="linenos">1301</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1302</span>        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">sigma</span>
<span class="linenos">1303</span>        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="linenos">1304</span>        <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">AVLTreeBitVector</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVLTreeBitVector</span><span class="p">()]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1305</span>        <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">:</span> <span class="n">array</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"I"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">))</span>
<span class="linenos">1306</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">1307</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">1308</span>
<span class="linenos">1309</span>    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1310</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s2">"B"</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
<span class="linenos">1311</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1312</span>            <span class="c1"># bit目の0/1に応じてvを構築 + aを安定ソート</span>
<span class="linenos">1313</span>            <span class="n">zero</span><span class="p">,</span> <span class="n">one</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="linenos">1314</span>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
<span class="linenos">1315</span>                <span class="k">if</span> <span class="n">e</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1316</span>                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">1317</span>                    <span class="n">one</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">1318</span>                <span class="k">else</span><span class="p">:</span>
<span class="linenos">1319</span>                    <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1320</span>                    <span class="n">zero</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="linenos">1321</span>            <span class="bp">self</span><span class="o">.</span><span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">zero</span><span class="p">)</span>  <span class="c1"># 境界をmid[bit]に保持</span>
<span class="linenos">1322</span>            <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">=</span> <span class="n">AVLTreeBitVector</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
<span class="linenos">1323</span>            <span class="n">a</span> <span class="o">=</span> <span class="n">zero</span> <span class="o">+</span> <span class="n">one</span>
<span class="linenos">1324</span>
<span class="linenos">1325</span>    <span class="k">def</span><span class="w"> </span><span class="nf">reserve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1326</span><span class="w">        </span><span class="sd">"""``n`` 要素分のメモリを確保します。</span>
<span class="linenos">1327</span><span class="sd">        :math:`O(n)` です。</span>
<span class="linenos">1328</span><span class="sd">        """</span>
<span class="linenos">1329</span>        <span class="k">assert</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.reserve(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">)"</span>
<span class="linenos">1330</span>        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">:</span>
<span class="linenos">1331</span>            <span class="n">v</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="linenos">1332</span>
<span class="linenos">1333</span>    <span class="k">def</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1334</span><span class="w">        </span><span class="sd">"""位置 ``k`` に ``x`` を挿入します。</span>
<span class="linenos">1335</span><span class="sd">        :math:`O(\\log{(n)}\\log{(\\sigma)})` です。</span>
<span class="linenos">1336</span><span class="sd">        """</span>
<span class="linenos">1337</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1338</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1339</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.insert(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1340</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1341</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1342</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.insert(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), LIM=</span><span class="si">{</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1343</span>        <span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
<span class="linenos">1344</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1345</span>            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1346</span>            <span class="c1"># if x &gt;&gt; bit &amp; 1:</span>
<span class="linenos">1347</span>            <span class="c1">#   v.insert(k, 1)</span>
<span class="linenos">1348</span>            <span class="c1">#   k = v.rank1(k) + mid[bit]</span>
<span class="linenos">1349</span>            <span class="c1"># else:</span>
<span class="linenos">1350</span>            <span class="c1">#   v.insert(k, 0)</span>
<span class="linenos">1351</span>            <span class="c1">#   mid[bit] += 1</span>
<span class="linenos">1352</span>            <span class="c1">#   k = v.rank0(k)</span>
<span class="linenos">1353</span>            <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">bit</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1354</span>                <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">_insert_and_rank1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos">1355</span>                <span class="n">k</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1356</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1357</span>                <span class="n">s</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">_insert_and_rank1</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="linenos">1358</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">s</span>
<span class="linenos">1359</span>                <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">1360</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">1361</span>
<span class="linenos">1362</span>    <span class="k">def</span><span class="w"> </span><span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="linenos">1363</span><span class="w">        </span><span class="sd">"""位置 ``k`` の要素を削除し、その値を返します。</span>
<span class="linenos">1364</span><span class="sd">        :math:`O(\\log{(n)}\\log{(\\sigma)})` です。</span>
<span class="linenos">1365</span><span class="sd">        """</span>
<span class="linenos">1366</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1367</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1368</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.pop(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">), n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1369</span>        <span class="n">mid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mid</span>
<span class="linenos">1370</span>        <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">1371</span>        <span class="k">for</span> <span class="n">bit</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">1372</span>            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1373</span>            <span class="c1"># K = k</span>
<span class="linenos">1374</span>            <span class="c1"># if v.access(k):</span>
<span class="linenos">1375</span>            <span class="c1">#   ans |= 1 &lt;&lt; bit</span>
<span class="linenos">1376</span>            <span class="c1">#   k = v.rank1(k) + mid[bit]</span>
<span class="linenos">1377</span>            <span class="c1"># else:</span>
<span class="linenos">1378</span>            <span class="c1">#   mid[bit] -= 1</span>
<span class="linenos">1379</span>            <span class="c1">#   k = v.rank0(k)</span>
<span class="linenos">1380</span>            <span class="c1"># v.pop(K)</span>
<span class="linenos">1381</span>            <span class="n">sb</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">_access_pop_and_rank1</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">1382</span>            <span class="n">s</span> <span class="o">=</span> <span class="n">sb</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<span class="linenos">1383</span>            <span class="k">if</span> <span class="n">sb</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">1384</span>                <span class="n">ans</span> <span class="o">|=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">bit</span>
<span class="linenos">1385</span>                <span class="n">k</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
<span class="linenos">1386</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">1387</span>                <span class="n">mid</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos">1388</span>                <span class="n">k</span> <span class="o">-=</span> <span class="n">s</span>
<span class="linenos">1389</span>        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos">1390</span>        <span class="k">return</span> <span class="n">ans</span>
<span class="linenos">1391</span>
<span class="linenos">1392</span>    <span class="k">def</span><span class="w"> </span><span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="linenos">1393</span><span class="w">        </span><span class="sd">"""位置 ``k`` の要素を ``x`` に更新します。</span>
<span class="linenos">1394</span><span class="sd">        :math:`O(\\log{(n)}\\log{(\\sigma)})` です。</span>
<span class="linenos">1395</span><span class="sd">        """</span>
<span class="linenos">1396</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1397</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1398</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.set(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1399</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1400</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1401</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.set(</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">), LIM=</span><span class="si">{</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1402</span>        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">1403</span>        <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">1404</span>
<span class="linenos">1405</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="linenos">1406</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1407</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="linenos">1408</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"IndexError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1409</span>        <span class="k">assert</span> <span class="p">(</span>
<span class="linenos">1410</span>            <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span>
<span class="linenos">1411</span>        <span class="p">),</span> <span class="sa">f</span><span class="s2">"ValueError: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">] = </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">, LIM=</span><span class="si">{</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="si">}</span><span class="s2">"</span>
<span class="linenos">1412</span>        <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="linenos">1413</span>
<span class="linenos">1414</span>    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="linenos">1415</span>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span><span class="si">}</span><span class="s2">)"</span>
</pre></div>
</div>
</section>
</section>
<section id="module-titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix">
<span id="id3"></span><h2>仕様<a class="headerlink" href="#module-titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix" title="Link to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre"></span></span><span class="sig-name descname"><span class="pre">DynamicWaveletMatrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sigma</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">a</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.html#DynamicWaveletMatrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix" title="Link to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="titan_pylib.data_structures.wavelet_matrix.wavelet_matrix.html#titan_pylib.data_structures.wavelet_matrix.wavelet_matrix.WaveletMatrix" title="titan_pylib.data_structures.wavelet_matrix.wavelet_matrix.WaveletMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">WaveletMatrix</span></code></a></p>
<p>動的ウェーブレット行列です。</p>
<dl class="simple">
<dt>(静的)ウェーブレット行列でできる操作に加えて <code class="docutils literal notranslate"><span class="pre">insert</span> <span class="pre">/</span> <span class="pre">pop</span> <span class="pre">/</span> <span class="pre">set</span></code> 等ができます。</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BitVector</span></code> を平衡二分木にしています(<code class="docutils literal notranslate"><span class="pre">AVLTreeBitVector</span></code>)。あらゆる操作に平衡二分木の log がつきます。これヤバくね</p></li>
</ul>
</dd>
</dl>
<p><span class="math notranslate nohighlight">\(O(n\log{(\sigma)})\)</span> です。</p>
<dl class="py method">
<dt class="sig sig-object py" id="titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.insert">
<span class="sig-name descname"><span class="pre">insert</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.html#DynamicWaveletMatrix.insert"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.insert" title="Link to this definition">¶</a></dt>
<dd><p>位置 <code class="docutils literal notranslate"><span class="pre">k</span></code> に <code class="docutils literal notranslate"><span class="pre">x</span></code> を挿入します。
<span class="math notranslate nohighlight">\(O(\log{(n)}\log{(\sigma)})\)</span> です。</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.pop">
<span class="sig-name descname"><span class="pre">pop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">int</span></span></span><a class="reference internal" href="../_modules/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.html#DynamicWaveletMatrix.pop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.pop" title="Link to this definition">¶</a></dt>
<dd><p>位置 <code class="docutils literal notranslate"><span class="pre">k</span></code> の要素を削除し、その値を返します。
<span class="math notranslate nohighlight">\(O(\log{(n)}\log{(\sigma)})\)</span> です。</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.reserve">
<span class="sig-name descname"><span class="pre">reserve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.html#DynamicWaveletMatrix.reserve"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.reserve" title="Link to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">n</span></code> 要素分のメモリを確保します。
<span class="math notranslate nohighlight">\(O(n)\)</span> です。</p>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.set">
<span class="sig-name descname"><span class="pre">set</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">k</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">→</span> <span class="sig-return-typehint"><span class="pre">None</span></span></span><a class="reference internal" href="../_modules/titan_pylib/data_structures/wavelet_matrix/dynamic_wavelet_matrix.html#DynamicWaveletMatrix.set"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.set" title="Link to this definition">¶</a></dt>
<dd><p>位置 <code class="docutils literal notranslate"><span class="pre">k</span></code> の要素を <code class="docutils literal notranslate"><span class="pre">x</span></code> に更新します。
<span class="math notranslate nohighlight">\(O(\log{(n)}\log{(\sigma)})\)</span> です。</p>
</dd></dl>
</dd></dl>
</section>
</section>
</article>
</div>
<footer>
<div class="related-pages">
<a class="next-page" href="titan_pylib.data_structures.wavelet_matrix.fenwick_tree_wavelet_matrix.html">
<div class="page-info">
<div class="context">
<span>Next</span>
</div>
<div class="title">fenwick_tree_wavelet_matrix</div>
</div>
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
</a>
<a class="prev-page" href="titan_pylib.data_structures.wavelet_matrix.cumulative_sum_wavelet_matrix.html">
<svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
<div class="page-info">
<div class="context">
<span>Previous</span>
</div>
<div class="title">cumulative_sum_wavelet_matrix</div>
</div>
</a>
</div>
<div class="bottom-of-page">
<div class="left-details">
<div class="copyright">
                Copyright © 2024, titan
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
</div>
<div class="right-details">
</div>
</div>
</footer>
</div>
<aside class="toc-drawer">
<div class="toc-sticky toc-scroll">
<div class="toc-title-container">
<span class="toc-title">
            On this page
          </span>
</div>
<div class="toc-tree-container">
<div class="toc-tree">
<ul>
<li><a class="reference internal" href="#">dynamic_wavelet_matrix</a><ul>
<li><a class="reference internal" href="#id1">ソースコード</a><ul>
<li><a class="reference internal" href="#id2">展開済みコード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix">仕様</a><ul>
<li><a class="reference internal" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix"><code class="docutils literal notranslate"><span class="pre">DynamicWaveletMatrix</span></code></a><ul>
<li><a class="reference internal" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.insert"><code class="docutils literal notranslate"><span class="pre">DynamicWaveletMatrix.insert()</span></code></a></li>
<li><a class="reference internal" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.pop"><code class="docutils literal notranslate"><span class="pre">DynamicWaveletMatrix.pop()</span></code></a></li>
<li><a class="reference internal" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.reserve"><code class="docutils literal notranslate"><span class="pre">DynamicWaveletMatrix.reserve()</span></code></a></li>
<li><a class="reference internal" href="#titan_pylib.data_structures.wavelet_matrix.dynamic_wavelet_matrix.DynamicWaveletMatrix.set"><code class="docutils literal notranslate"><span class="pre">DynamicWaveletMatrix.set()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</aside>
</div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=9bcbadda"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="../_static/scripts/furo.js?v=5fa4622c"></script>
<script src="../_static/clipboard.min.js?v=a7894cd8"></script>
<script src="../_static/copybutton.js?v=4ea706d9"></script>
<script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="../_static/_static/script.js"></script>
</body>
</html>