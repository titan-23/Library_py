<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="css/dark.css">
<title>PersistentLazyAVLTree</title>
</head>
<body>
<hr /><h1><code>PersistentLazyAVLTree</code></h1><hr /><h2>コード</h2><p><a href="https://github.com/titanium-22/Library_py/blob/main/DataStructures/AVLTree/PersistentLazyAVLTree.py"><code>PersistentLazyAVLTree</code></a></p><hr /><ul>
<li>♰完全永続遅延伝播反転可能抽象化平衡二分探索木♰</li>
</ul><hr /><h2>仕様</h2><h4><code>avl = PersistentLazyAVLTree(a: Iterable[T],  op, mapping, composition, e, id, copy_t, copy_f)</code></h4><ul>
<li><code>PersistentLazyAVLTree</code> を構築します。</li>
</ul><ul>
<li>時間・空間共に <code>O(N)</code> です。</li>
</ul><h4><code>avl.merge(other: PersistentLazyAVLTree) -&gt; PersistentLazyAVLTree</code></h4><ul>
<li><code>avl</code> の後ろに <code>other</code> を連結？させた <code>PersistentLazyAVLTree</code> を返します。</li>
</ul><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.split(k: int) -&gt; Tuple[PersistentLazyAVLTree, PersistentLazyAVLTree]</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.apply(l: int, r: int, f: F) -&gt; PersistentLazyAVLTree</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.prod(l: int, r) -&gt; T</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.insert(k: int, key: T) -&gt; PersistentLazyAVLTree</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.pop(k: int) -&gt; Tuple[PersistentLazyAVLTree, T]</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.reverse(l: int, r: int) -&gt; PersistentLazyAVLTree</code></h4><ul>
<li>時間・空間共に <code>O(logN)</code> です。</li>
</ul><h4><code>avl.tolist() -&gt; List[T]</code></h4><ul>
<li>時間・空間共に <code>O(N)</code> です。</li>
</ul><h4><code>avl[k: int] -&gt; T</code></h4><ul>
<li>時間 <code>O(logN)</code> 、空間 <code>O(1)</code> です。</li>
</ul><h4><code>len(avl) / str(avl) / repr(avl)</code></h4><hr /><h2>使用例</h2><p><a href="https://atcoder.jp/contests/arc030/submissions/45758203">グラフではない</a></p><p>```python</p><p>op = lambda s, t: (s[0]+t[0], s[1]+t[1])</p><p>mapping = lambda f, s: (s[0] + f * s[1], s[1])</p><p>composition = lambda f, g: f + g</p><p>copy_t = lambda s: s</p><p>copy_f = lambda f: f</p><p>e = (0, 0)</p><p>id = 0</p><p>n, q = map(int, input().split())</p><p>X = list(map(int, input().split()))</p><p>X = [(x, 1) for x in X]</p><p>avl = PersistentLazyAVLTree(X, op, mapping, composition, e, id, copy_t, copy_f)</p><p>for _ in range(q):</p><p>com, *qu = list(map(int, input().split()))</p><p>if com == 1:</p><pre><code>a, b, v = qu
</code></pre><pre><code>a -= 1; b -= 1
</code></pre><pre><code>avl = avl.apply(a, b+1, v)
</code></pre><p>if com == 2:</p><pre><code>a, b, c, d = qu
</code></pre><pre><code>a -= 1; b -= 1; c -= 1; d -= 1
</code></pre><pre><code>t, _ = avl.split(d+1)
</code></pre><pre><code>_, t = t.split(c)
</code></pre><pre><code>y, z = avl.split(b+1)
</code></pre><pre><code>x, _ = y.split(a)
</code></pre><pre><code>avl = x.merge(t)
</code></pre><pre><code>avl = avl.merge(z)
</code></pre><p>if com == 3:</p><pre><code>a, b = qu
</code></pre><pre><code>a -= 1; b -= 1
</code></pre><pre><code>ans = avl.prod(a, b+1)[0]
</code></pre><pre><code>print(ans)
</code></pre><p>```</p>
</body>
</html>
